function ClassCallback(t,e){return function(){return e.apply(t,arguments)}}function Rectangle(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}}if(void 0===Float32Array)var Float32Array=function(){return[0,0]};"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,16)},window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof String.prototype.format&&(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),window.console=window.console||{log:function(){},error:function(){}};var Class=function(){};!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var s=new this;t=!1;for(var r in i)s[r]="function"==typeof i[r]&&"function"==typeof o[r]&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=o[t];var n=e.apply(this,arguments);return this._super=i,n}}(r,i[r]):i[r];return n.prototype=s,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var Callback=ClassCallback;!function(t,e){"use strict";var i=function t(e,i){return new t.Instance(e,i||{})};i.VERSION="1.1.2",i.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.DOCUMENT=document,i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&i.IS_MOBILE||i.HAS_POINTEREVENTS,i.CALCULATE_INTERVAL=25;var n={},o=i.DIRECTION_DOWN="down",s=i.DIRECTION_LEFT="left",r=i.DIRECTION_UP="up",a=i.DIRECTION_RIGHT="right",h=i.POINTER_MOUSE="mouse",d=i.POINTER_TOUCH="touch",c=i.POINTER_PEN="pen",l=i.EVENT_START="start",u=i.EVENT_MOVE="move",f=i.EVENT_END="end",g=i.EVENT_RELEASE="release",p=i.EVENT_TOUCH="touch";i.READY=!1,i.plugins=i.plugins||{},i.gestures=i.gestures||{};var m=i.utils={extend:function(t,i,n){for(var o in i)!i.hasOwnProperty(o)||t[o]!==e&&n||(t[o]=i[o]);return t},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)},each:function(t,i,n){var o,s;if("forEach"in t)t.forEach(i,n);else if(t.length!==e){for(o=0,s=t.length;s>o;o++)if(!1===i.call(n,t[o],o,t))return}else for(o in t)if(t.hasOwnProperty(o)&&!1===i.call(n,t[o],o,t))return},inStr:function(t,e){return t.indexOf(e)>-1},inArray:function(t,e){if(t.indexOf){var i=t.indexOf(e);return-1!==i&&i}for(var n=0,o=t.length;o>n;n++)if(t[n]===e)return n;return!1},toArray:function(t){return Array.prototype.slice.call(t,0)},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],i=[],n=[],o=[],s=Math.min,r=Math.max;return 1===t.length?{pageX:t[0].pageX,pageY:t[0].pageY,clientX:t[0].clientX,clientY:t[0].clientY}:(m.each(t,function(t){e.push(t.pageX),i.push(t.pageY),n.push(t.clientX),o.push(t.clientY)}),{pageX:(s.apply(Math,e)+r.apply(Math,e))/2,pageY:(s.apply(Math,i)+r.apply(Math,i))/2,clientX:(s.apply(Math,n)+r.apply(Math,n))/2,clientY:(s.apply(Math,o)+r.apply(Math,o))/2})},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){return Math.abs(t.clientX-e.clientX)>=Math.abs(t.clientY-e.clientY)?t.clientX-e.clientX>0?s:a:t.clientY-e.clientY>0?r:o},getDistance:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==r||t==o},setPrefixedCss:function(t,e,i,n){var o=["","Webkit","Moz","O","ms"];e=m.toCamelCase(e);for(var s=0;s<o.length;s++){var r=e;if(o[s]&&(r=o[s]+r.slice(0,1).toUpperCase()+r.slice(1)),r in t.style){t.style[r]=(null==n||n)&&i||"";break}}},toggleBehavior:function(t,e,i){if(e&&t&&t.style){m.each(e,function(e,n){m.setPrefixedCss(t,n,e,i)});var n=i&&function(){return!1};"none"==e.userSelect&&(t.onselectstart=n),"none"==e.userDrag&&(t.ondragstart=n)}},toCamelCase:function(t){return t.replace(/[_-]([a-z])/g,function(t){return t[1].toUpperCase()})}},y=i.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(t,e,i,n){var o=e.split(" ");m.each(o,function(e){m.on(t,e,i),n&&n(e)})},off:function(t,e,i,n){var o=e.split(" ");m.each(o,function(e){m.off(t,e,i),n&&n(e)})},onTouch:function(t,e,o){var s=this,r=function(n){var r,a=n.type.toLowerCase(),h=i.HAS_POINTEREVENTS,d=m.inStr(a,"mouse");d&&s.preventMouseEvents||(d&&e==l&&0===n.button?(s.preventMouseEvents=!1,s.shouldDetect=!0):h&&e==l?s.shouldDetect=1===n.buttons:d||e!=l||(s.preventMouseEvents=!0,s.shouldDetect=!0),h&&e!=f&&v.updatePointer(e,n),s.shouldDetect&&(r=s.doDetect.call(s,n,e,t,o)),r==f&&(s.preventMouseEvents=!1,s.shouldDetect=!1,v.reset()),h&&e==f&&v.updatePointer(e,n))};return this.on(t,n[e],r),r},doDetect:function(t,e,i,n){var o=this.getTouchList(t,e),s=o.length,r=e,a=o.trigger,h=s;e==l?a=p:e==f&&(a=g,h=o.length-(t.changedTouches?t.changedTouches.length:1)),h>0&&this.started&&(r=u),this.started=!0;var d=this.collectEventData(i,r,o,t);return e!=f&&n.call(P,d),a&&(d.changedLength=h,d.eventType=a,n.call(P,d),d.eventType=r,delete d.changedLength),r==f&&(n.call(P,d),this.started=!1),r},determineEventTypes:function(){var e;return e=i.HAS_POINTEREVENTS?t.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n[l]=e[0],n[u]=e[1],n[f]=e[2],n},getTouchList:function(t,e){if(i.HAS_POINTEREVENTS)return v.getTouchList();if(t.touches){if(e==u)return t.touches;var n=[],o=[].concat(m.toArray(t.touches),m.toArray(t.changedTouches)),s=[];return m.each(o,function(t){!1===m.inArray(n,t.identifier)&&s.push(t),n.push(t.identifier)}),s}return t.identifier=1,[t]},collectEventData:function(t,e,i,n){var o=d;return m.inStr(n.type,"mouse")||v.matchType(h,n)?o=h:v.matchType(c,n)&&(o=c),{center:m.getCenter(i),timeStamp:Date.now(),target:n.target,touches:i,eventType:e,pointerType:o,srcEvent:n,preventDefault:function(){var t=this.srcEvent;t.preventManipulation&&t.preventManipulation(),t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return P.stopDetect()}}}},v=i.PointerEvent={pointers:{},getTouchList:function(){var t=[];return m.each(this.pointers,function(e){t.push(e)}),t},updatePointer:function(t,e){t==f||t!=f&&1!==e.buttons?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i=e.pointerType,n={};return n[h]=i===(e.MSPOINTER_TYPE_MOUSE||h),n[d]=i===(e.MSPOINTER_TYPE_TOUCH||d),n[c]=i===(e.MSPOINTER_TYPE_PEN||c),n[t]},reset:function(){this.pointers={}}},P=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:m.extend({},e),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst,i=e.options;return m.each(this.gestures,function(n){return!this.stopped&&e.enabled&&i[n.name]&&!1===n.handler.call(n,t,e)?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=t),t.eventType==f&&this.stopDetect(),t}},stopDetect:function(){this.previous=m.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(t,e,n,o,s){var r=this.current,a=!1,h=r.lastCalcEvent,d=r.lastCalcData;h&&t.timeStamp-h.timeStamp>i.CALCULATE_INTERVAL&&(e=h.center,n=t.timeStamp-h.timeStamp,o=t.center.clientX-h.center.clientX,s=t.center.clientY-h.center.clientY,a=!0),(t.eventType==p||t.eventType==g)&&(r.futureCalcEvent=t),(!r.lastCalcEvent||a)&&(d.velocity=m.getVelocity(n,o,s),d.angle=m.getAngle(e,t.center),d.direction=m.getDirection(e,t.center),r.lastCalcEvent=r.futureCalcEvent||t,r.futureCalcEvent=t),t.velocityX=d.velocity.x,t.velocityY=d.velocity.y,t.interimAngle=d.angle,t.interimDirection=d.direction},extendEventData:function(t){var e=this.current,i=e.startEvent,n=e.lastEvent||i;(t.eventType==p||t.eventType==g)&&(i.touches=[],m.each(t.touches,function(t){i.touches.push({clientX:t.clientX,clientY:t.clientY})}));var o=t.timeStamp-i.timeStamp,s=t.center.clientX-i.center.clientX,r=t.center.clientY-i.center.clientY;return this.getCalculatedData(t,n.center,o,s,r),m.extend(t,{startEvent:i,deltaTime:o,deltaX:s,deltaY:r,distance:m.getDistance(i.center,t.center),angle:m.getAngle(i.center,t.center),direction:m.getDirection(i.center,t.center),scale:m.getScale(i.touches,t.touches),rotation:m.getRotation(i.touches,t.touches)}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),m.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}};i.Instance=function(t,e){var n=this;i.READY||(y.determineEventTypes(),m.each(i.gestures,function(t){P.register(t)}),y.onTouch(i.DOCUMENT,u,P.detect),y.onTouch(i.DOCUMENT,f,P.detect),i.READY=!0),this.element=t,this.enabled=!0,m.each(e,function(t,i){delete e[i],e[m.toCamelCase(i)]=t}),this.options=m.extend(m.extend({},i.defaults),e||{}),this.options.behavior&&m.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=y.onTouch(t,l,function(t){n.enabled&&t.eventType==l?P.startDetect(n,t):t.eventType==p&&P.detect(t)}),this.eventHandlers=[]},i.Instance.prototype={on:function(t,e){var i=this;return y.on(i.element,t,e,function(t){i.eventHandlers.push({gesture:t,handler:e})}),i},off:function(t,e){var i=this;return y.off(i.element,t,e,function(t){var n=m.inArray({gesture:t,handler:e});!1!==n&&i.eventHandlers.splice(n,1)}),i},trigger:function(t,e){e||(e={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var o=this.element;return m.hasParent(e.target,o)&&(o=e.target),o.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(m.toggleBehavior(this.element,this.options.behavior,!1),t=-1;e=this.eventHandlers[++t];)m.off(this.element,e.gesture,e.handler);return this.eventHandlers=[],y.off(this.element,n[l],this.eventStartHandler),null}},function(t){var e=!1;i.gestures.Drag={name:t,index:50,handler:function(i,n){var h=P.current;if(!(n.options.dragMaxTouches>0&&i.touches.length>n.options.dragMaxTouches))switch(i.eventType){case l:e=!1;break;case u:if(i.distance<n.options.dragMinDistance&&h.name!=t)return;var d=h.startEvent.center;if(h.name!=t&&(h.name=t,n.options.dragDistanceCorrection&&i.distance>0)){var c=Math.abs(n.options.dragMinDistance/i.distance);d.pageX+=i.deltaX*c,d.pageY+=i.deltaY*c,d.clientX+=i.deltaX*c,d.clientY+=i.deltaY*c,i=P.extendEventData(i)}(h.lastEvent.dragLockToAxis||n.options.dragLockToAxis&&n.options.dragLockMinDistance<=i.distance)&&(i.dragLockToAxis=!0);var p=h.lastEvent.direction;i.dragLockToAxis&&p!==i.direction&&(i.direction=m.isVertical(p)?i.deltaY<0?r:o:i.deltaX<0?s:a),e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),n.trigger(t+i.direction,i);var y=m.isVertical(i.direction);(n.options.dragBlockVertical&&y||n.options.dragBlockHorizontal&&!y)&&i.preventDefault();break;case g:e&&i.changedLength<=n.options.dragMaxTouches&&(n.trigger(t+"end",i),e=!1);break;case f:e=!1}},defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),i.gestures.Gesture={name:"gesture",index:1337,handler:function(t,e){e.trigger(this.name,t)}},function(t){var e;i.gestures.Hold={name:t,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:function(i,n){var o=n.options,s=P.current;switch(i.eventType){case l:clearTimeout(e),s.name=t,e=setTimeout(function(){s&&s.name==t&&n.trigger(t,i)},o.holdTimeout);break;case u:i.distance>o.holdThreshold&&clearTimeout(e);break;case g:clearTimeout(e)}}}}("hold"),i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==g&&e.trigger(this.name,t)}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(t,e){if(t.eventType==g){var i=t.touches.length,n=e.options;if(i<n.swipeMinTouches||i>n.swipeMaxTouches)return;(t.velocityX>n.swipeVelocityX||t.velocityY>n.swipeVelocityY)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},function(t){var e=!1;i.gestures.Tap={name:t,index:100,handler:function(i,n){var o,s,r=n.options,a=P.current,h=P.previous;switch(i.eventType){case l:e=!1;break;case u:e=e||i.distance>r.tapMaxDistance;break;case f:"touchcancel"!=i.srcEvent.type&&i.deltaTime<r.tapMaxTime&&!e&&(o=h&&h.lastEvent&&i.timeStamp-h.lastEvent.timeStamp,s=!1,h&&h.name==t&&o&&o<r.doubleTapInterval&&i.distance<r.doubleTapDistance&&(n.trigger("doubletap",i),s=!0),(!s||r.tapAlways)&&(a.name=t,n.trigger(a.name,i)))}},defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),i.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(t,e){return e.options.preventMouse&&t.pointerType==h?void t.stopDetect():(e.options.preventDefault&&t.preventDefault(),void(t.eventType==p&&e.trigger("touch",t)))}},function(t){var e=!1;i.gestures.Transform={name:t,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:function(i,n){switch(i.eventType){case l:e=!1;break;case u:if(i.touches.length<2)return;var o=Math.abs(1-i.scale),s=Math.abs(i.rotation);if(o<n.options.transformMinScale&&s<n.options.transformMinRotation)return;P.current.name=t,e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),s>n.options.transformMinRotation&&n.trigger("rotate",i),o>n.options.transformMinScale&&(n.trigger("pinch",i),n.trigger("pinch"+(i.scale<1?"in":"out"),i));break;case g:e&&i.changedLength<2&&(n.trigger(t+"end",i),e=!1)}}}}("transform"),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.Hammer=i}(window),function(){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports=window:t.exports=exports,function(t){if(void 0===e)var e={};if(!u)u=1e-6;if(e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,i){return t[0]=e,t[1]=i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},e.sub=e.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},e.mul=e.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},e.div=e.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},e.dist=e.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},e.sqrDist=e.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},e.len=e.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},e.sqrLen=e.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var i=e[0],n=e[1],o=i*i+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,i,n){var o=e[0],s=e[1];return t[0]=o+n*(i[0]-o),t[1]=s+n*(i[1]-s),t},e.transformMat2=function(t,e,i){var n=e[0],o=e[1];return t[0]=n*i[0]+o*i[1],t[1]=n*i[2]+o*i[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,i,n,o,s,r){var a,h;for(i||(i=2),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],s(t,t,r),e[a]=t[0],e[a+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},void 0!==t&&(t.vec2=e),void 0===i)var i={};if(!u)u=1e-6;if(i.create=function(){return new Float32Array(3)},i.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.fromValues=function(t,e,i){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},i.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},i.sub=i.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},i.mul=i.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},i.div=i.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},i.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},i.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},i.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},i.dist=i.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(i*i+n*n+o*o)},i.sqrDist=i.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return i*i+n*n+o*o},i.len=i.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},i.sqrLen=i.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},i.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],s=i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.cross=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=i[0],a=i[1],h=i[2];return t[0]=o*h-s*a,t[1]=s*r-n*h,t[2]=n*a-o*r,t},i.lerp=function(t,e,i,n){var o=e[0],s=e[1],r=e[2];return t[0]=o+n*(i[0]-o),t[1]=s+n*(i[1]-s),t[2]=r+n*(i[2]-r),t},i.transformMat4=function(t,e,i){var n=e[0],o=e[1],s=e[2];return t[0]=i[0]*n+i[4]*o+i[8]*s+i[12],t[1]=i[1]*n+i[5]*o+i[9]*s+i[13],t[2]=i[2]*n+i[6]*o+i[10]*s+i[14],t},i.transformQuat=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=i[0],a=i[1],h=i[2],d=i[3],c=d*n+a*s-h*o,l=d*o+h*n-r*s,u=d*s+r*o-a*n,f=-r*n-a*o-h*s;return t[0]=c*d+f*-r+l*-h-u*-a,t[1]=l*d+f*-a+u*-r-c*-h,t[2]=u*d+f*-h+c*-a-l*-r,t},i.forEach=function(){var t=new Float32Array(3);return function(e,i,n,o,s,r){var a,h;for(i||(i=3),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},void 0!==t&&(t.vec3=i),void 0===n)var n={};if(!u)u=1e-6;if(n.create=function(){return new Float32Array(4)},n.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var o=new Float32Array(4);return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,n,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.sub=n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.mul=n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.div=n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.dist=n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+n*n+o*o+s*s)},n.sqrDist=n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],s=e[3]-t[3];return i*i+n*n+o*o+s*s},n.len=n.length=function(t){var e=t[0],i=t[1],n=t[2],o=t[3];return Math.sqrt(e*e+i*i+n*n+o*o)},n.sqrLen=n.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],o=t[3];return e*e+i*i+n*n+o*o},n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=i*i+n*n+o*o+s*s;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,n){var o=e[0],s=e[1],r=e[2],a=e[3];return t[0]=o+n*(i[0]-o),t[1]=s+n*(i[1]-s),t[2]=r+n*(i[2]-r),t[3]=a+n*(i[3]-a),t},n.transformMat4=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3];return t[0]=i[0]*n+i[4]*o+i[8]*s+i[12]*r,t[1]=i[1]*n+i[5]*o+i[9]*s+i[13]*r,t[2]=i[2]*n+i[6]*o+i[10]*s+i[14]*r,t[3]=i[3]*n+i[7]*o+i[11]*s+i[15]*r,t},n.transformQuat=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=i[0],a=i[1],h=i[2],d=i[3],c=d*n+a*s-h*o,l=d*o+h*n-r*s,u=d*s+r*o-a*n,f=-r*n-a*o-h*s;return t[0]=c*d+f*-r+l*-h-u*-a,t[1]=l*d+f*-a+u*-r-c*-h,t[2]=u*d+f*-h+c*-a-l*-r,t},n.forEach=function(){var t=new Float32Array(4);return function(e,i,n,o,s,r){var a,h;for(i||(i=4),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.vec4=n),void 0===o)var o={};var s=new Float32Array([1,0,0,1]);if(!u)u=1e-6;if(o.create=function(){return new Float32Array(s)},o.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=i*s-o*n;return r?(r=1/r,t[0]=s*r,t[1]=-n*r,t[2]=-o*r,t[3]=i*r,t):null},o.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.mul=o.multiply=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=i[0],h=i[1],d=i[2],c=i[3];return t[0]=n*a+o*d,t[1]=n*h+o*c,t[2]=s*a+r*d,t[3]=s*h+r*c,t},o.rotate=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=n*-a+o*h,t[2]=s*h+r*a,t[3]=s*-a+r*h,t},o.scale=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=o*h,t[2]=s*a,t[3]=r*h,t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.mat2=o),void 0===r)var r={};var a=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!u)u=1e-6;if(r.create=function(){return new Float32Array(a)},r.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.invert=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=c*r-a*d,u=-c*s+a*h,f=d*s-r*h,g=i*l+n*u+o*f;return g?(g=1/g,t[0]=l*g,t[1]=(-c*n+o*d)*g,t[2]=(a*n-o*r)*g,t[3]=u*g,t[4]=(c*i-o*h)*g,t[5]=(-a*i+o*s)*g,t[6]=f*g,t[7]=(-d*i+n*h)*g,t[8]=(r*i-n*s)*g,t):null},r.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=e[4],a=e[5],h=e[6],d=e[7],c=e[8];return t[0]=r*c-a*d,t[1]=o*d-n*c,t[2]=n*a-o*r,t[3]=a*h-s*c,t[4]=i*c-o*h,t[5]=o*s-i*a,t[6]=s*d-r*h,t[7]=n*h-i*d,t[8]=i*r-n*s,t},r.determinant=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],s=t[4],r=t[5],a=t[6],h=t[7],d=t[8];return e*(d*s-r*h)+i*(-d*o+r*a)+n*(h*o-s*a)},r.mul=r.multiply=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],u=i[0],f=i[1],g=i[2],p=i[3],m=i[4],y=i[5],v=i[6],P=i[7],I=i[8];return t[0]=u*n+f*r+g*d,t[1]=u*o+f*a+g*c,t[2]=u*s+f*h+g*l,t[3]=p*n+m*r+y*d,t[4]=p*o+m*a+y*c,t[5]=p*s+m*h+y*l,t[6]=v*n+P*r+I*d,t[7]=v*o+P*a+I*c,t[8]=v*s+P*h+I*l,t},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},void 0!==t&&(t.mat3=r),void 0===h)var h={};var d=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!u)u=1e-6;h.create=function(){return new Float32Array(d)},h.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[3],s=e[6],r=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=o,t[13]=r,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},h.invert=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],u=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15],v=i*a-n*r,P=i*h-o*r,I=i*d-s*r,w=n*h-o*a,A=n*d-s*a,b=o*d-s*h,W=c*p-l*g,x=c*m-u*g,O=c*y-f*g,C=l*m-u*p,L=l*y-f*p,M=u*y-f*m,S=v*M-P*L+I*C+w*O-A*x+b*W;return S?(S=1/S,t[0]=(a*M-h*L+d*C)*S,t[1]=(o*L-n*M-s*C)*S,t[2]=(p*b-m*A+y*w)*S,t[3]=(u*A-l*b-f*w)*S,t[4]=(h*O-r*M-d*x)*S,t[5]=(i*M-o*O+s*x)*S,t[6]=(m*I-g*b-y*P)*S,t[7]=(c*b-u*I+f*P)*S,t[8]=(r*L-a*O+d*W)*S,t[9]=(n*O-i*L-s*W)*S,t[10]=(g*A-p*I+y*v)*S,t[11]=(l*I-c*A-f*v)*S,t[12]=(a*x-r*C-h*W)*S,t[13]=(i*C-n*x+o*W)*S,t[14]=(p*P-g*w-m*v)*S,t[15]=(c*w-l*P+u*v)*S,t):null},h.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],u=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15];return t[0]=a*(u*y-f*m)-l*(h*y-d*m)+p*(h*f-d*u),t[1]=-(n*(u*y-f*m)-l*(o*y-s*m)+p*(o*f-s*u)),t[2]=n*(h*y-d*m)-a*(o*y-s*m)+p*(o*d-s*h),t[3]=-(n*(h*f-d*u)-a*(o*f-s*u)+l*(o*d-s*h)),t[4]=-(r*(u*y-f*m)-c*(h*y-d*m)+g*(h*f-d*u)),t[5]=i*(u*y-f*m)-c*(o*y-s*m)+g*(o*f-s*u),t[6]=-(i*(h*y-d*m)-r*(o*y-s*m)+g*(o*d-s*h)),t[7]=i*(h*f-d*u)-r*(o*f-s*u)+c*(o*d-s*h),t[8]=r*(l*y-f*p)-c*(a*y-d*p)+g*(a*f-d*l),t[9]=-(i*(l*y-f*p)-c*(n*y-s*p)+g*(n*f-s*l)),t[10]=i*(a*y-d*p)-r*(n*y-s*p)+g*(n*d-s*a),t[11]=-(i*(a*f-d*l)-r*(n*f-s*l)+c*(n*d-s*a)),t[12]=-(r*(l*m-u*p)-c*(a*m-h*p)+g*(a*u-h*l)),t[13]=i*(l*m-u*p)-c*(n*m-o*p)+g*(n*u-o*l),t[14]=-(i*(a*m-h*p)-r*(n*m-o*p)+g*(n*h-o*a)),t[15]=i*(a*u-h*l)-r*(n*u-o*l)+c*(n*h-o*a),t},h.determinant=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],s=t[4],r=t[5],a=t[6],h=t[7],d=t[8],c=t[9],l=t[10],u=t[11],f=t[12],g=t[13],p=t[14],m=t[15];return(e*r-i*s)*(l*m-u*p)-(e*a-n*s)*(c*m-u*g)+(e*h-o*s)*(c*p-l*g)+(i*a-n*r)*(d*m-u*f)-(i*h-o*r)*(d*p-l*f)+(n*h-o*a)*(d*g-c*f)},h.mul=h.multiply=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],u=e[9],f=e[10],g=e[11],p=e[12],m=e[13],y=e[14],v=e[15],P=i[0],I=i[1],w=i[2],A=i[3];return t[0]=P*n+I*a+w*l+A*p,t[1]=P*o+I*h+w*u+A*m,t[2]=P*s+I*d+w*f+A*y,t[3]=P*r+I*c+w*g+A*v,P=i[4],I=i[5],w=i[6],A=i[7],t[4]=P*n+I*a+w*l+A*p,t[5]=P*o+I*h+w*u+A*m,t[6]=P*s+I*d+w*f+A*y,t[7]=P*r+I*c+w*g+A*v,P=i[8],I=i[9],w=i[10],A=i[11],t[8]=P*n+I*a+w*l+A*p,t[9]=P*o+I*h+w*u+A*m,t[10]=P*s+I*d+w*f+A*y,t[11]=P*r+I*c+w*g+A*v,P=i[12],I=i[13],w=i[14],A=i[15],t[12]=P*n+I*a+w*l+A*p,t[13]=P*o+I*h+w*u+A*m,t[14]=P*s+I*d+w*f+A*y,t[15]=P*r+I*c+w*g+A*v,t},h.translate=function(t,e,i){var n,o,s,r,a,h,d,c,l,u,f,g,p=i[0],m=i[1],y=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*y+e[12],t[13]=e[1]*p+e[5]*m+e[9]*y+e[13],t[14]=e[2]*p+e[6]*m+e[10]*y+e[14],t[15]=e[3]*p+e[7]*m+e[11]*y+e[15]):(n=e[0],o=e[1],s=e[2],r=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],u=e[9],f=e[10],g=e[11],t[0]=n,t[1]=o,t[2]=s,t[3]=r,t[4]=a,t[5]=h,t[6]=d,t[7]=c,t[8]=l,t[9]=u,t[10]=f,t[11]=g,t[12]=n*p+a*m+l*y+e[12],t[13]=o*p+h*m+u*y+e[13],t[14]=s*p+d*m+f*y+e[14],t[15]=r*p+c*m+g*y+e[15]),t},h.scale=function(t,e,i){var n=i[0],o=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.rotate=function(t,e,i,n){var o,s,r,a,h,d,c,l,f,g,p,m,y,v,P,I,w,A,b,W,x,O,C,L,M=n[0],S=n[1],R=n[2],D=Math.sqrt(M*M+S*S+R*R);return Math.abs(D)<u?null:(D=1/D,M*=D,S*=D,R*=D,o=Math.sin(i),s=Math.cos(i),r=1-s,a=e[0],h=e[1],d=e[2],c=e[3],l=e[4],f=e[5],g=e[6],p=e[7],m=e[8],y=e[9],v=e[10],P=e[11],I=M*M*r+s,w=S*M*r+R*o,A=R*M*r-S*o,b=M*S*r-R*o,W=S*S*r+s,x=R*S*r+M*o,O=M*R*r+S*o,C=S*R*r-M*o,L=R*R*r+s,t[0]=a*I+l*w+m*A,t[1]=h*I+f*w+y*A,t[2]=d*I+g*w+v*A,t[3]=c*I+p*w+P*A,t[4]=a*b+l*W+m*x,t[5]=h*b+f*W+y*x,t[6]=d*b+g*W+v*x,t[7]=c*b+p*W+P*x,t[8]=a*O+l*C+m*L,t[9]=h*O+f*C+y*L,t[10]=d*O+g*C+v*L,t[11]=c*O+p*C+P*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},h.rotateX=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),s=e[4],r=e[5],a=e[6],h=e[7],d=e[8],c=e[9],l=e[10],u=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*o+d*n,t[5]=r*o+c*n,t[6]=a*o+l*n,t[7]=h*o+u*n,t[8]=d*o-s*n,t[9]=c*o-r*n,t[10]=l*o-a*n,t[11]=u*o-h*n,t},h.rotateY=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),s=e[0],r=e[1],a=e[2],h=e[3],d=e[8],c=e[9],l=e[10],u=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*o-d*n,t[1]=r*o-c*n,t[2]=a*o-l*n,t[3]=h*o-u*n,t[8]=s*n+d*o,t[9]=r*n+c*o,t[10]=a*n+l*o,t[11]=h*n+u*o,t},h.rotateZ=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),s=e[0],r=e[1],a=e[2],h=e[3],d=e[4],c=e[5],l=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*o+d*n,t[1]=r*o+c*n,t[2]=a*o+l*n,t[3]=h*o+u*n,t[4]=d*o-s*n,t[5]=c*o-r*n,t[6]=l*o-a*n,t[7]=u*o-h*n,t},h.fromRotationTranslation=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=n+n,h=o+o,d=s+s,c=n*a,l=n*h,u=n*d,f=o*h,g=o*d,p=s*d,m=r*a,y=r*h,v=r*d;return t[0]=1-(f+p),t[1]=l+v,t[2]=u-y,t[3]=0,t[4]=l-v,t[5]=1-(c+p),t[6]=g+m,t[7]=0,t[8]=u+y,t[9]=g-m,t[10]=1-(c+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},h.frustum=function(t,e,i,n,o,s,r){var a=1/(i-e),h=1/(o-n),d=1/(s-r);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(o+n)*h,t[10]=(r+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=r*s*2*d,t[15]=0,t},h.perspective=function(t,e,i,n,o){var s=1/Math.tan(e/2),r=1/(n-o);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+n)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*n*r,t[15]=0,t},h.ortho=function(t,e,i,n,o,s,r){var a=1/(e-i),h=1/(n-o),d=1/(s-r);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+i)*a,t[13]=(o+n)*h,t[14]=(r+s)*d,t[15]=1,t},h.lookAt=function(t,e,i,n){var o,s,r,a,d,c,l,f,g,p,m=e[0],y=e[1],v=e[2],P=n[0],I=n[1],w=n[2],A=i[0],b=i[1],W=i[2];return Math.abs(m-A)<u&&Math.abs(y-b)<u&&Math.abs(v-W)<u?h.identity(t):(l=m-A,f=y-b,g=v-W,p=1/Math.sqrt(l*l+f*f+g*g),l*=p,f*=p,g*=p,o=I*g-w*f,s=w*l-P*g,r=P*f-I*l,(p=Math.sqrt(o*o+s*s+r*r))?(o*=p=1/p,s*=p,r*=p):(o=0,s=0,r=0),a=f*r-g*s,d=g*o-l*r,c=l*s-f*o,(p=Math.sqrt(a*a+d*d+c*c))?(a*=p=1/p,d*=p,c*=p):(a=0,d=0,c=0),t[0]=o,t[1]=a,t[2]=l,t[3]=0,t[4]=s,t[5]=d,t[6]=f,t[7]=0,t[8]=r,t[9]=c,t[10]=g,t[11]=0,t[12]=-(o*m+s*y+r*v),t[13]=-(a*m+d*y+c*v),t[14]=-(l*m+f*y+g*v),t[15]=1,t)},h.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},void 0!==t&&(t.mat4=h);var c={},l=new Float32Array([0,0,0,1]);if(!u)var u=1e-6;c.create=function(){return new Float32Array(l)},c.clone=n.clone,c.fromValues=n.fromValues,c.copy=n.copy,c.set=n.set,c.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},c.setAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},c.add=n.add,c.mul=c.multiply=function(t,e,i){var n=e[0],o=e[1],s=e[2],r=e[3],a=i[0],h=i[1],d=i[2],c=i[3];return t[0]=n*c+r*a+o*d-s*h,t[1]=o*c+r*h+s*a-n*d,t[2]=s*c+r*d+n*h-o*a,t[3]=r*c-n*a-o*h-s*d,t},c.scale=n.scale,c.rotateX=function(t,e,i){i*=.5;var n=e[0],o=e[1],s=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=o*h+s*a,t[2]=s*h-o*a,t[3]=r*h-n*a,t},c.rotateY=function(t,e,i){i*=.5;var n=e[0],o=e[1],s=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-s*a,t[1]=o*h+r*a,t[2]=s*h+n*a,t[3]=r*h-o*a,t},c.rotateZ=function(t,e,i){i*=.5;var n=e[0],o=e[1],s=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=o*h-n*a,t[2]=s*h+r*a,t[3]=r*h-s*a,t},c.calculateW=function(t,e){var i=e[0],n=e[1],o=e[2];return t[0]=i,t[1]=n,t[2]=o,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-o*o)),t},c.dot=n.dot,c.lerp=n.lerp,c.slerp=function(t,e,i,n){var o,s,r,a,h=e[0],d=e[1],c=e[2],l=e[3],u=i[0],f=i[1],g=i[2],p=e[3],m=h*u+d*f+c*g+l*p;return Math.abs(m)>=1?(t!==e&&(t[0]=h,t[1]=d,t[2]=c,t[3]=l),t):(o=Math.acos(m),s=Math.sqrt(1-m*m),Math.abs(s)<.001?(t[0]=.5*h+.5*u,t[1]=.5*d+.5*f,t[2]=.5*c+.5*g,t[3]=.5*l+.5*p,t):(r=Math.sin((1-n)*o)/s,a=Math.sin(n*o)/s,t[0]=h*r+u*a,t[1]=d*r+f*a,t[2]=c*r+g*a,t[3]=l*r+p*a,t))},c.invert=function(t,e){var i=e[0],n=e[1],o=e[2],s=e[3],r=i*i+n*n+o*o+s*s,a=r?1/r:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-o*a,t[3]=s*a,t},c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.len=c.length=n.length,c.sqrLen=c.squaredLength=n.squaredLength,c.normalize=n.normalize,c.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.quat=c)}(t.exports)}();var ArrayUtility=Class.extend({init:function(t){if(t instanceof Object){var e=t;this.data=[];for(var i in e)this.data.push(e[i])}else{if(!(t instanceof Array))throw"Argument objectOrArray must be an object or array";this.data=t}},get:function(){return this.data},sort:function(t){return this.data.sort(function(e,i){return t(e,i)?1:t(i,e)?-1:0}),this.data}}),Color=function(t,e,i,n){this.r=1,this.g=1,this.b=1,this.a=1,this.clone=function(){return new Color(this.r,this.g,this.b,this.a)},this.fromHex=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(t);return e&&(this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255,e[4]&&(this.a=parseInt(e[4],16)/255)),this},this.toHex=function(){var t=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e};return"#"+t(255*this.r)+t(255*this.g)+t(255*this.b)+t(255*this.a)},this.toString=function(){return"rgba("+Math.floor(255*this.r)+", "+Math.floor(255*this.g)+", "+Math.floor(255*this.b)+", "+this.a+")"},this.toVector=function(){return vec4.fromValues(this.r,this.g,this.b,this.a)},this.set=function(t,e,i,n){"number"==typeof t&&(this.r=t),"number"==typeof e&&(this.g=e),"number"==typeof i&&(this.b=i),"number"==typeof n&&(this.a=n)},this.set(t,e,i,n)},WayfinderAPI={LOCATION:"//api.3dwayfinder.com/",PROJECT:!1,getJSON:function(t,e){Logistics.getJSON(t,e).error(function(t){console&&console.log&&console.log("Failed to get JSON: "+JSON.stringify(t))})},getURL:function(t,e,i){if(!1===WayfinderAPI.PROJECT)throw"No project opened! Call WayfinderAPI.open(<project name>);";return i=i||[],[WayfinderAPI.LOCATION,"public",WayfinderAPI.PROJECT,t,e].concat(i).join("/")},open:function(t){WayfinderAPI.PROJECT=t}};WayfinderAPI["2d"]={},WayfinderAPI["3d"]={},WayfinderAPI.access={},WayfinderAPI.advertisements={},WayfinderAPI.beacons={},WayfinderAPI.building={},WayfinderAPI.guitranslations={},WayfinderAPI.images={},WayfinderAPI.languages={},WayfinderAPI.lights={},WayfinderAPI.locationgroups={},WayfinderAPI.locations={},WayfinderAPI.materials={},WayfinderAPI.mobile={},WayfinderAPI.models={},WayfinderAPI.navigation={},WayfinderAPI.poisettings={},WayfinderAPI.svg={},WayfinderAPI.settings={},WayfinderAPI.statistics={},WayfinderAPI.templates={},WayfinderAPI.textures={},WayfinderAPI["2d"].bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","bundle",[]),t)},WayfinderAPI["2d"].bundle.url=function(){return WayfinderAPI.getURL("2d","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","edges",[]),t)},WayfinderAPI["2d"].edges.url=function(){return WayfinderAPI.getURL("2d","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","getWatermark",[]),t)},WayfinderAPI["2d"].getWatermark.url=function(){return WayfinderAPI.getURL("2d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].image=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","image",[t]),e)},WayfinderAPI["2d"].image.url=function(t){return WayfinderAPI.getURL("2d","image",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lod=function(t,e,i,n,o){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lod",[t,e,i,n]),o)},WayfinderAPI["2d"].lod.url=function(t,e,i,n){return WayfinderAPI.getURL("2d","lod",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lodcount=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lodcount",[]),t)},WayfinderAPI["2d"].lodcount.url=function(){return WayfinderAPI.getURL("2d","lodcount",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","nodes",[]),t)},WayfinderAPI["2d"].nodes.url=function(){return WayfinderAPI.getURL("2d","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].overlays=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","overlays",[]),t)},WayfinderAPI["2d"].overlays.url=function(){return WayfinderAPI.getURL("2d","overlays",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].pack=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","pack",[]),t)},WayfinderAPI["2d"].pack.url=function(){return WayfinderAPI.getURL("2d","pack",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","getWatermark",[]),t)},WayfinderAPI["3d"].getWatermark.url=function(){return WayfinderAPI.getURL("3d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].pack=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","pack",[]),t)},WayfinderAPI["3d"].pack.url=function(){return WayfinderAPI.getURL("3d","pack",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].scene=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","scene",[]),t)},WayfinderAPI["3d"].scene.url=function(){return WayfinderAPI.getURL("3d","scene",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.hasWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","hasWatermark",[]),t)},WayfinderAPI.access.hasWatermark.url=function(){return WayfinderAPI.getURL("access","hasWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.template=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","template",[t]),e)},WayfinderAPI.access.template.url=function(t){return WayfinderAPI.getURL("access","template",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","all",[]),t)},WayfinderAPI.advertisements.all.url=function(){return WayfinderAPI.getURL("advertisements","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.data=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","data",[t]),e)},WayfinderAPI.advertisements.data.url=function(t){return WayfinderAPI.getURL("advertisements","data",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.frames=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","frames",[t,e,i]),n)},WayfinderAPI.advertisements.frames.url=function(t,e,i){return WayfinderAPI.getURL("advertisements","frames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacon=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacon",[t]),e)},WayfinderAPI.beacons.getBeacon.url=function(t){return WayfinderAPI.getURL("beacons","getBeacon",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacons=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacons",[]),t)},WayfinderAPI.beacons.getBeacons.url=function(){return WayfinderAPI.getURL("beacons","getBeacons",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.levels=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","levels",[]),t)},WayfinderAPI.building.levels.url=function(){return WayfinderAPI.getURL("building","levels",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.location=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","location",[]),t)},WayfinderAPI.building.location.url=function(){return WayfinderAPI.getURL("building","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.pack=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","pack",[]),t)},WayfinderAPI.building.pack.url=function(){return WayfinderAPI.getURL("building","pack",Array.prototype.slice.call(arguments,0))},WayfinderAPI.guitranslations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("guitranslations","get",[]),t)},WayfinderAPI.guitranslations.get.url=function(){return WayfinderAPI.getURL("guitranslations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.checkImage=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","checkImage",[t]),e)},WayfinderAPI.images.checkImage.url=function(t){return WayfinderAPI.getURL("images","checkImage",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","get",[t]),e)},WayfinderAPI.images.get.url=function(t){return WayfinderAPI.getURL("images","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","thumbnail",[t]),e)},WayfinderAPI.images.thumbnail.url=function(t){return WayfinderAPI.getURL("images","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","get",[]),t)},WayfinderAPI.languages.get.url=function(){return WayfinderAPI.getURL("languages","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.translation=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","translation",[t]),e)},WayfinderAPI.languages.translation.url=function(t){return WayfinderAPI.getURL("languages","translation",Array.prototype.slice.call(arguments,0))},WayfinderAPI.lights.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("lights","get",[]),t)},WayfinderAPI.lights.get.url=function(){return WayfinderAPI.getURL("lights","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locationgroups.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locationgroups","get",[]),t)},WayfinderAPI.locationgroups.get.url=function(){return WayfinderAPI.getURL("locationgroups","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.byfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","byfloor",[]),t)},WayfinderAPI.locations.byfloor.url=function(){return WayfinderAPI.getURL("locations","byfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bygroup=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bygroup",[]),t)},WayfinderAPI.locations.bygroup.url=function(){return WayfinderAPI.getURL("locations","bygroup",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bynode=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bynode",[t]),e)},WayfinderAPI.locations.bynode.url=function(t){return WayfinderAPI.getURL("locations","bynode",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","get",[]),t)},WayfinderAPI.locations.get.url=function(){return WayfinderAPI.getURL("locations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.location=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","location",[t]),e)},WayfinderAPI.locations.location.url=function(t){return WayfinderAPI.getURL("locations","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.tags=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","tags",[]),t)},WayfinderAPI.locations.tags.url=function(){return WayfinderAPI.getURL("locations","tags",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","get",[]),t)},WayfinderAPI.materials.get.url=function(){return WayfinderAPI.getURL("materials","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textureMaterialNames=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textureMaterialNames",[t]),e)},WayfinderAPI.materials.textureMaterialNames.url=function(t){return WayfinderAPI.getURL("materials","textureMaterialNames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textures=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textures",[t]),e)},WayfinderAPI.materials.textures.url=function(t){return WayfinderAPI.getURL("materials","textures",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.uniforms=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","uniforms",[t]),e)},WayfinderAPI.materials.uniforms.url=function(t){return WayfinderAPI.getURL("materials","uniforms",Array.prototype.slice.call(arguments,0))},WayfinderAPI.mobile.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("mobile","bundle",[]),t)},WayfinderAPI.mobile.bundle.url=function(){return WayfinderAPI.getURL("mobile","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","all",[]),t)},WayfinderAPI.models.all.url=function(){return WayfinderAPI.getURL("models","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.allmeshes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","allmeshes",[]),t)},WayfinderAPI.models.allmeshes.url=function(){return WayfinderAPI.getURL("models","allmeshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","get",[]),t)},WayfinderAPI.models.get.url=function(){return WayfinderAPI.getURL("models","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.instances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","instances",[]),t)},WayfinderAPI.models.instances.url=function(){return WayfinderAPI.getURL("models","instances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.json=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","json",[t]),e)},WayfinderAPI.models.json.url=function(t){return WayfinderAPI.getURL("models","json",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshes",[t]),e)},WayfinderAPI.models.meshes.url=function(t){return WayfinderAPI.getURL("models","meshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesOfInstances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesOfInstances",[]),t)},WayfinderAPI.models.meshesOfInstances.url=function(){return WayfinderAPI.getURL("models","meshesOfInstances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesbyfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesbyfloor",[]),t)},WayfinderAPI.models.meshesbyfloor.url=function(){return WayfinderAPI.getURL("models","meshesbyfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.model=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","model",[t]),e)},WayfinderAPI.models.model.url=function(t){return WayfinderAPI.getURL("models","model",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.allAttributes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","allAttributes",[]),t)},WayfinderAPI.navigation.allAttributes.url=function(){return WayfinderAPI.getURL("navigation","allAttributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.attributes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","attributes",[t]),e)},WayfinderAPI.navigation.attributes.url=function(t){return WayfinderAPI.getURL("navigation","attributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","edges",[]),t)},WayfinderAPI.navigation.edges.url=function(){return WayfinderAPI.getURL("navigation","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.node=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","node",[t]),e)},WayfinderAPI.navigation.node.url=function(t){return WayfinderAPI.getURL("navigation","node",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodes",[]),t)},WayfinderAPI.navigation.nodes.url=function(){return WayfinderAPI.getURL("navigation","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodesbytype=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodesbytype",[t]),e)},WayfinderAPI.navigation.nodesbytype.url=function(t){return WayfinderAPI.getURL("navigation","nodesbytype",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","get",[]),t)},WayfinderAPI.poisettings.get.url=function(){return WayfinderAPI.getURL("poisettings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getAllPOISettings=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getAllPOISettings",[]),t)},WayfinderAPI.poisettings.getAllPOISettings.url=function(){return WayfinderAPI.getURL("poisettings","getAllPOISettings",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getText",[t]),e)},WayfinderAPI.poisettings.getText.url=function(t){return WayfinderAPI.getURL("poisettings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getTexts",[]),t)},WayfinderAPI.poisettings.getTexts.url=function(){return WayfinderAPI.getURL("poisettings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","map",[]),t)},WayfinderAPI.poisettings.map.url=function(){return WayfinderAPI.getURL("poisettings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","setting",[t]),e)},WayfinderAPI.poisettings.setting.url=function(t){return WayfinderAPI.getURL("poisettings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","bundle",[]),t)},WayfinderAPI.svg.bundle.url=function(){return WayfinderAPI.getURL("svg","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","get",[t]),e)},WayfinderAPI.svg.get.url=function(t){return WayfinderAPI.getURL("svg","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","get",[]),t)},WayfinderAPI.settings.get.url=function(){return WayfinderAPI.getURL("settings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getText",[t]),e)},WayfinderAPI.settings.getText.url=function(t){return WayfinderAPI.getURL("settings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getTexts",[]),t)},WayfinderAPI.settings.getTexts.url=function(){return WayfinderAPI.getURL("settings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","map",[]),t)},WayfinderAPI.settings.map.url=function(){return WayfinderAPI.getURL("settings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","setting",[t]),e)},WayfinderAPI.settings.setting.url=function(t){return WayfinderAPI.getURL("settings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.click=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","click",[t,e,i]),n)},WayfinderAPI.statistics.click.url=function(t,e,i){return WayfinderAPI.getURL("statistics","click",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.device=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","device",[t,e,i]),n)},WayfinderAPI.statistics.device.url=function(t,e,i){return WayfinderAPI.getURL("statistics","device",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.endSession=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","endSession",[t,e]),i)},WayfinderAPI.statistics.endSession.url=function(t,e){return WayfinderAPI.getURL("statistics","endSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.search=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","search",[t,e,i]),n)},WayfinderAPI.statistics.search.url=function(t,e,i){return WayfinderAPI.getURL("statistics","search",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.startSession=function(t,e,i,n,o,s){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","startSession",[t,e,i,n,o]),s)},WayfinderAPI.statistics.startSession.url=function(t,e,i,n,o){return WayfinderAPI.getURL("statistics","startSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.templates.css=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("templates","css",[t]),e)},WayfinderAPI.templates.css.url=function(t){return WayfinderAPI.getURL("templates","css",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.count=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","count",[]),t)},WayfinderAPI.textures.count.url=function(){return WayfinderAPI.getURL("textures","count",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","map",[]),t)},WayfinderAPI.textures.map.url=function(){return WayfinderAPI.getURL("textures","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.mipmap=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","mipmap",[t,e]),i)},WayfinderAPI.textures.mipmap.url=function(t,e){return WayfinderAPI.getURL("textures","mipmap",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.names=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","names",[]),t)},WayfinderAPI.textures.names.url=function(){return WayfinderAPI.getURL("textures","names",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texture=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texture",[t]),e)},WayfinderAPI.textures.texture.url=function(t){return WayfinderAPI.getURL("textures","texture",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texturebyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texturebyid",[t]),e)},WayfinderAPI.textures.texturebyid.url=function(t){return WayfinderAPI.getURL("textures","texturebyid",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnail",[t]),e)},WayfinderAPI.textures.thumbnail.url=function(t){return WayfinderAPI.getURL("textures","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnailbyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnailbyid",[t]),e)},WayfinderAPI.textures.thumbnailbyid.url=function(t){return WayfinderAPI.getURL("textures","thumbnailbyid",Array.prototype.slice.call(arguments,0))};var WayfinderOptions=Class.extend({init:function(){this.application="wayfinder",this.map="map",this.project="demo",this.kiosk=!1,this.debugLog=!1,this.debugPOIs=!1,this.debugTranslations=!1,this.drawKioskIcon=!0,this.apiLocation="../../api/",this.language="en",this.disablePathDrawing=!1,this.searchScroreLimiter=3,this.searchMinimumScrore=10,this.filterPOIs="",this.assetsLocation="/shared/",this.pathDisplayInstructions=!0,this.pathZoomPadding=100,this.pathColor="rgba(255,0,0,0.8)",this.pathPauseTime=2e3,this.pathSpotRadius=3,this.pathStride=30,this.pathSpeed=60,this.zoomPadding=1.05,this.poiColor="rgba(100,200,0,0.9)",this.poiRadius=9,this.textureLOD=0,this.debugTransparency=!1,this.disableModelLoading=!1,this.disableCollisionTrees=!1,this.disableRendering=!1,this.mapSize=[1024,1024],this.forceFullMapUpdate=!1,this.enableLOD=!0,this.maxLOD=2,this.enableUserLocation=!0,this.overlayHighlightColor="#ff0000dd",this.mapPadding=.1,this.enableUserYAHSetting=!1,this.application="2D",this.pathZoomIn=!1,this.poi2DTitlePadding=12,this.path2DMessageSize=16,this.map2DRotation=0,this.disableMap2DMovement=!1,this.debug=!1,this.debugBeacons=!1,this.debugMouseLocation=!1,this.upscale=1,this.yahRotation=0,this.poi2DTitleWeight="normal",this.factory=new WayfinderFactory},loadFromURL:function(){if(location.hash.length>=2&&location.hash.indexOf("{")>-1){var t=unescape(location.hash.substring(1)).split("#");if(t.length>=1&&t[0].indexOf("{")>-1&&t[0].indexOf("}")>-1){i=JSON.parse(t[0]);for(var e in i)log("Overriding option: "+e+"="+i[e]),this[e]=i[e],"kiosk"===e&&(this["kiosk.default"]=i[e])}}else if(location.search.length>=2){var i=unescape(location.search.substring(1)).split("&");if(console.log("location.search.1",i),i.length>=1){var n;for(var e in i)(n=i[e].split("=")).length>1&&(log("Overriding option: "+n[0]+"="+n[1]),this[n[0]]=n[1],"kiosk"===n[0]&&(this["kiosk.default"]=n[1]))}}}}),WF_DEBUG=!1,Wayfinder=Class.extend({init:function(t,e){t&&t instanceof WayfinderOptions||(t=new WayfinderOptions),e||(e=new WayfinderFactory(this)),this.factory=e,this.setOptions(t),this.settings=new Settings,this.statistics=new WFStatistics(this),this.firstFinishedLoading=!1,this.debugLog=!1,this.kiosk=!1,this.dataLoaded=!1,t.debugLog&&DebugLog&&"DebugLog"==typeof DebugLog&&(this.debugLog=new DebugLog(t.debugLog)),Logistics.onStageProgress(ClassCallback(this,this.onStageProgress)),Logistics.onProgress(ClassCallback(this,this.onProgress)),this.languages={},this.pois={},this.poisArray=[],this.poiGroups={},this.nodes={},this.edges={},this.attributes={},this.poisettings=new Settings,this.poiAdvertisements={},this.advertisements={},this.translator=new Translator(this.options.language,{}),this.building=null,this.firstLanguageChange=!0,this.search=new WayfinderSearch(this),this.events=new WayfinderEvents(this),this.currentFloor=!1,this.accessibility="",this.maps={},this.hasWatermark=!0},cbOnPOIClick:function(t){},cbOnDataLoaded:function(){},cbOnProgress:function(t){},cbOnStageProgress:function(t,e){},cbOnLanguageChange:function(t){},cbOnBeforeFloorChange:function(t){},cbOnFloorChange:function(t){},cbOnZoomChange:function(t){},cbOnPathStep:function(t,e){},cbOnPathStart:function(t,e){},cbOnPathFinished:function(t){},cbOnTouch:function(t,e){},cbOnMapUpdate:function(){},cbOnMapReady:function(){},cbOnLocationChange:function(t){},cbOnWebGLContextFail:function(){console.warn("cbOnWebGLContextFail has to be overridden")},finishedLoading:function(t){this.firstFinishedLoading||(this.firstFinishedLoading=!0,this.onDataLoaded())},setOptions:function(t){this.options=t,this.options.project=this.readProjectName(),this.options.loadFromURL()},setStyle:function(t){$("head").append('<link rel="stylesheet" type="text/css" href="{0}">'.format(WayfinderAPI.templates.css.url(t)))},open:function(t){void 0!==t&&(this.options.project=t),WayfinderAPI.open(this.options.project),this.startLoading(),"undefined"!=typeof document&&document.addEventListener("visibilitychange",ClassCallback(this,this.onVisibilityChange)),console.log("Open",this.options.project)},readProjectName:function(){if("undefined"!=typeof document)for(var t=document.location.pathname.split("/"),e=0;e<t.length;e++)if("projects"==t[e]&&t.length>e+1)return t[e+1];return this.options.project},getLayout:function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("meta");for(var e in t)if("layout"==t[e].name)return t[e].content;for(var i=document.location.pathname.split("/"),e=0;e<i.length;e++)if("projects"==i[e]&&i.length>e+2)return i[e+2]}return"default"},log:function(){this.debugLog&&this.debugLog.logArray(this.log.arguments)},getProject:function(){return this.options.project},getAPILocation:function(){return WayfinderAPI&&WayfinderAPI.LOCATION?WayfinderAPI.LOCATION:this.options.apiLocation},setKiosk:function(t){this.options.kiosk=t},getKiosk:function(){return this.options.kiosk},getKioskNode:function(){return!!(this.options.kiosk&&this.options.kiosk in this.nodes)&&this.nodes[this.options.kiosk]},showPath:function(t,e){return this.logic.showPath(this.getKioskNode(),t,e)},showKiosk:function(){return this.logic.showKiosk()},showFloor:function(t,e){this.logic.showFloor(t),"object"==typeof t&&this.building.setActiveFloors(t),console.log("showFloor",this.cbOnFloorChange,"function"==typeof this.cbOnFloorChange),this.cbOnFloorChange&&"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(t)},getLanguage:function(){return this.translator.getLanguage()},setLanguage:function(t){this.translator.translate(t),"function"==typeof this.cbOnLanguageChange&&(this.cbOnLanguageChange(t),this.events.trigger("language-change",t))},startLoading:function(){Logistics.getJSON(WayfinderAPI.building.pack.url(),null,ClassCallback(this,this.onBundleData),{stage:"settings"})},onBundleData:function(t){console.log("Wayfinder.onBundleData",t);var e=t.data;this.settings.data=e.settings,this.poisettings.data=e.poisettings,this.hasWatermark=e.hasWatermark,this.texts=e.texts,this.onSettings(),e.guitranslations&&this.translator.setTranslations(e.guitranslations),this.factory.createLanguages(e.languages),this.factory.createFloors(e.levels),this.factory.createLocations(e)},loadSecondaryResources:function(){var t=this;setTimeout(function(){t.loadHiddenPOIIcons()},1e3)},loadHiddenPOIIcons:function(t){if(this.pois)for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&!this.pois[e].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","thumbnail",[this.pois[e].image_id]),ClassCallback(this.pois[e],this.pois[e].setIcon))},onAdvertisementsLoaded:function(t){this.advertisements=t.data},onSettings:function(){this.building=this.factory.createBuilding(this.settings.data),this.options.language=this.settings.get("language.default",this.options.language),this.setLanguage(this.options.language),!1===this.options.kiosk&&this.setKiosk(this.settings.getInt("kiosk.default",0))},onFinishedLoading:function(){this.cbOnProgress(100),this.cbOnDataLoaded();var t=this;setTimeout(function(){t.statistics.start()},100)},createTranslations:function(t){this.translator&&t&&this.translator.setTranslations(t.data)},onProgress:function(t){"function"==typeof this.cbOnProgress&&this.cbOnProgress(t)},onStageProgress:function(t,e){"function"==typeof this.cbOnStageProgress&&this.cbOnStageProgress(t,e)},resize:function(){this.logic.resize()},onPOIClick:function(t,e,i){"function"==typeof this.cbOnPOIClick&&this.cbOnPOIClick(t,e,i)},onZoomChange:function(t){"function"==typeof this.cbOnZoomChange&&this.cbOnZoomChange(t)},setZoom:function(t){},zoomIn:function(){},zoomOut:function(){},pathToText:function(t){},textPathSimplification:function(t){function e(t){return t>=45&&t<135?"right":t>=135&&t<225?"around":t>=225&&t<315&&"left"}var i={},n="generic portal kiosk landmark";if(i.distance=0,i.steps=[],t&&t.length>0){for(var o=!1,s=t[t.length-1].bNode,r=0,a=0;a<t.length;a++)i.distance+=t[a].distance,r+=t[a].distance,o=e(t[a].angle),t[a].type&&"landmark"==t[a].type&&(t[a].bNode&&t[a].bNode.pois&&t[a].bNode.pois.length>0?i.steps.push({landmark:t[a].bNode.pois,endNode:t[a].bNode,startNode:s,in:r}):t[a].aNode&&t[a].aNode.pois&&t[a].aNode.pois.length>0&&i.steps.push({landmark:t[a].aNode.pois,endNode:t[a].aNode,startNode:s,in:r})),o&&("string"==typeof t[a].type&&-1==n.indexOf(t[a].type)||(r>0&&i.steps.push({walk:r/100,endNode:t[a].bNode,startNode:s}),i.steps.push({turn:o,endNode:t[a].bNode,startNode:s,in:r})),s=t[a].bNode,r=0),t[a].type&&-1==n.indexOf(t[a].type)&&(a>0&&a<t.length-1&&t[a].type!==t[a+1].type&&(r>0&&i.steps.push({walk:lastDistanc/100,endNode:t[a].bNode,startNode:s}),i.steps.push({use:t[a].type,endNode:t[a].bNode,startNode:s,in:r}),s=t[a].bNode),r=0),t[a].go_to_floor&&(r>0&&i.steps({walk:r/100,endNode:t[a].bNode,startNode:s}),r=0,i.steps.push({go_to_floor:t[a].go_to_floor,endNode:t[a].bNode,startNode:s}),s=t[a].bNode);r>0&&i.steps.push({walk:r/100,endNode:t[t.length-1].bNode,startNode:s})}return i},getPOIWithExternalId:function(t){for(var e in this.pois)if(this.pois[e].room_id==t)return this.pois[e];return!1},getNearestPOI:function(t,e){},restoreDefaultState:function(){this.options.language&&this.setLanguage(this.options.language),this.clearHighlights(),this.showKiosk()},showScreensaver:function(){},hideScreensaver:function(){},setHighlights:function(t){},clearHighlights:function(){},setDisplaying:function(t){},clearDisplaying:function(){},onSetLanguage:function(t){},getLanguages:function(){return this.languages},getPOIs:function(){return this.pois},getPOIsArray:function(){return this.poisArray},getPOIGroups:function(){return this.poiGroups},getNodes:function(){return this.nodes},getEdges:function(){return this.edges},clearPath:function(){},zoomOnPathSegment:function(t,e){},getCurrentFloor:function(){return this.building.getCurrentFloor()},setCurrentFloor:function(t){return this.building.setCurrentFloor(t)},findNearestNodeOnFloor:function(t,e){return this.logic.findNearestNodeOnFloor(t,e)},getImageData:function(){return!1},createExtraMap:function(t,e,i){if("function"!=typeof e)throw console.log("Logic",e),new Error("Given logic is not a function");e=new e(this,t),this.maps[t]={logic:e,canvas:i,loaded:!1},e.initData(),e.loadMapData()},isMapInitialized:function(t){return!!this.maps[t]},switchToMap:function(t){if(!this.maps[t])throw new Error("No such map inialized: "+t);for(var e in this.maps)"object"==typeof this.maps[e]&&this.maps[e].logic&&this.maps[e].logic.pause();this.logic=this.maps[t].logic,this.logic.run()},isDataLoaded:function(t){return!!this.loadedData[t]},run:function(){return this.logic.run()},pause:function(){return this.logic.pause()},update:function(t){return this.logic.update(t)},getScreenPosition:function(t){return this.logic.getScreenPosition(t)},switchCanvas:function(t){this.logic.switchCanvas(t)},getNearestPOIs:function(t,e,i){return this.logic.getNearestPOIs(t,e,i)}}),WayfinderFactory=Class.extend({init:function(t){this.wayfinder=t},createFloors:function(t){if(t&&this.wayfinder.building)for(var e in t)"object"==typeof t[e]&&this.wayfinder.building.addFloor(this.createFloor(t[e],this.wayfinder.languages))},createNodes:function(t){if(t)for(var e=this.wayfinder.settings.getInt("kiosk.default",0),i=this.wayfinder.building.getFloors(),n=0;n<t.length;n++){var o=this.createNode(t[n]);o&&(this.wayfinder.nodes[t[n].id]=o,o.floor_id in i&&i[o.floor_id].addNode(o),t[n].id==e&&(this.wayfinder.kiosk=o))}},createAttributes:function(t){t&&(this.wayfinder.attributes=t)},createPOIs:function(t){for(var e=0;e<t.length;e++){var i=this.createPOI(t[e],this.wayfinder.languages);this.wayfinder.pois[t[e].id]=i,this.wayfinder.poisArray.push(i),i.node_id in this.wayfinder.nodes&&this.wayfinder.nodes[i.node_id].addPOI(i),this.wayfinder.poisettings&&this.wayfinder.poisettings.data&&this.wayfinder.poisettings.data[i.id]&&(i.settings.data=this.wayfinder.poisettings.data[i.id])}},createTags:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];n&&n.setTags(i.tags)}},filterPOIs:function(t){if(t&&t.length>0){var e,i="";for(var n in t)if((i=t[n].trim())&&""!==i)for(var o in this.wayfinder.pois)(e=this.wayfinder.pois[o]).setShowInMenu(!1),e.getTags().indexOf(i)>-1&&e.setShowInMenu(!0)}},createGroups:function(t,e){if(e&&t){var i,n;for(n in t)i=this.createPOIGroup(t[n],this.wayfinder.languages),this.wayfinder.poiGroups[i.getID()]=i;for(var o in e){n=e[o];for(var s in n){var r=this.wayfinder.pois[n[s]];i=this.wayfinder.poiGroups[o],r&&i&&(i.addPOI(r),r.addGroup(i))}}}},createAdvertisements:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];if(n){var o=this.createPOIAdvertisement(n,i,this.wayfinder.languages);this.wayfinder.poiAdvertisements[i.id]=o,n.addAdvertisement(o)}}},addPOIsToFloor:function(t){for(var e in t){var i=this.wayfinder.building.getFloors();if(e in i){var n=i[e];for(var o in t[e])t[e][o]in this.wayfinder.pois&&n.addPOI(this.wayfinder.pois[t[e][o]])}}},createEdges:function(t){if(t){for(var e in t)if(e in this.wayfinder.nodes)for(var i in t[e])t[e][i]in this.wayfinder.nodes&&this.wayfinder.nodes[e].addNeighbour(this.wayfinder.nodes[t[e][i]]);this.wayfinder.edges=t}},createBuilding:function(t){return new Building(t)},createFloor:function(t,e){return new Floor(t,e)},createNode:function(t){return new NavigationNode(t)},createPOI:function(t,e){return new POI(t,e)},createPOIGroup:function(t,e){return new POIGroup(t,e)},createPOIAdvertisement:function(t,e,i){return new POIAdvertisement(t,e,i)},createLanguages:function(t){for(var e in t)this.wayfinder.languages[e]=new Language(t[e]),e.toLowerCase()==this.wayfinder.options.language.toLowerCase()&&(this.wayfinder.translator.language=e);this.wayfinder.translator.translate()},createLocations:function(t){this.createNodes(t.navigation.nodes),this.createEdges(t.navigation.edges),this.createPOIs(t.locations.all),this.addPOIsToFloor(t.locations.byfloor),this.createGroups(t.locations.groups,t.locations.bygroup),this.createTags(t.locations.tags),this.wayfinder.options.filterPOIs&&this.filterPOIs(this.wayfinder.options.filterPOIs.trim().split(",")),this.wayfinder.advertisements=t.a,this.createAttributes(t.locations.attributes)}}),WayfinderSearch=Class.extend({init:function(t){this.wayfinder=t,this.searchParams=[],this.limit=0,this.options={maxSearchParams:15,stringSearch:"relative",minimumScore:1,splitKeywords:!0,limit:1/0,scoreLimit:1.25,searchStringLength:2,poi:{name:1,description:.5,tags:1,room_id:.5}},this.results={},this.highScore=0,this.scores=[],this.providers={},this.setupProviders()},overrideOptions:function(t){for(var e in t)this.options[e]=t[e]},setupProviders:function(){this.providers.poi=ClassCallback(this,this.POIsProvider)},clearResults:function(){this.results={},this.highScore=0,this.scores=[]},search:function(t,e,i){var n="poi";if(this.clearResults(),"string"==typeof e&&(n=e),this.overrideOptions(i),void 0!==t&&t.length>=this.options.searchStringLength){t=t.trim().toLowerCase(),this.options.splitKeywords?this.searchParams=t.split(" "):this.searchParams.push(t),this.searchParams.length>this.options.maxSearchParams&&this.searchParams.splice(this.options.maxSearchParams,this.searchParams.length-this.options.maxSearchParams);this.wayfinder.pois;for(var o=0;o<this.searchParams.length;o++)this.providers[n]&&"function"==typeof this.providers[n]&&this.providers[n](this.searchParams[o],this.wayfinder)}return this.order(this.results,this.highScore,this.scores)},pushResult:function(t,e,i){t>=this.options.minimumScore&&(t=parseFloat(parseFloat(t).toFixed(2)),this.results[t]||(this.results[t]={}),-1==this.scores.indexOf(t)&&this.scores.push(t),this.results[t][e]=i,this.highScore=Math.max(this.highScore,t))},POIsProvider:function(t,e){function i(t,e){var i=0;return o.options.poi.name&&t.getName(n)&&(i=o.searchString(t.getName(n),e,o.options.poi.name)),o.options.poi.description&&t.getDescription(n)&&(i=Math.max(i,o.searchString(t.getDescription(n),e,o.options.poi.description))),o.options.poi.tags&&t.getTags()&&(i=Math.max(i,o.searchString(t.getTags(),e,o.options.poi.tags))),o.options.poi.room_id&&t.getRoomId()&&(i=Math.max(i,o.searchString(t.getRoomId(),e,o.options.poi.room_id))),i}var n=this.wayfinder.getLanguage(),o=this,s=e.pois;for(var r in s)s[r].getShowInMenu()&&(score=i(s[r],t),this.pushResult(score,s[r].getID(),s[r]))},findWithChar:function(t){var e=[],i=this.wayfinder.getLanguage();e[0]=[];var n=this.sortPOIs(this.wayfinder.pois);for(var o in n)n[o].getShowInMenu()&&n[o].getName(i).charAt(0)==t&&e[0].push(n[o])},searchString:function(t,e,i){if("string"==typeof t&&"string"==typeof e)switch(t=t.toLowerCase().trim(),e=e.toLowerCase().trim(),this.options.stringSearch){case"strict":return this.searchStringStrict(t,e,i);case"relative":return this.searchStringRelatively(t,e,i);default:return this.searchStringStrict(t,e,i)}return 0},searchStringStrict:function(t,e,i){if(!t||!e)return 0;var n=e.indexOf(t);if(n>-1){return((n=n/t.length*100)+e.length/t.length*100)/2}return 0},searchStringRelatively:function(t,e,i){function n(t,e,i){for(var n=0,o=0,s=0,r=-1,a=0;a<t.length;a++)r==t[a]-1?(o++,n=Math.max(n,o)):(s+=t[a]-r-1,o=1),r=t[a];var h=n/i.length*1.4;return h+=0===t[0]?1:0,h+=1-s/i.length,h+=t.length/e,h+=n/e*1.2,h+=e>i.length?0:t.length/i.length*1.3,10*(h+=e.length==i.length?1:0)}if(!t||!e)return 0;var o=e.split(""),s=t.split(/,\s*|\s/),r=0,a=0,h=[],d=-1,c=0;i||(i=1);for(var l=0;l<s.length;l++)if((t=s[l]).length>1){for(;a<t.length;){if(t[a]===o[r]){if(c=a,h.push(a),++r>=o.length)break}else a==t.length-1&&r<o.length&&(a=c,r++);a++}d=h.length>0?Math.max(d,n(h,o.length,t)):Math.max(d,-1),r=0,a=0,h.length=0}return d=Math.round(d*i)},order:function(t,e,i){if(!t||0==t.length)return[];var n,o=[],s=0,r=i.sort(function(t,e){return t-e}).reverse();for(var a in r)if(n=r[a],t[n]){var h;for(var a in t[n]){if(h=t[n][parseInt(a)],e/n>this.options.scoreLimit&&s>0)return o;if(o.push(h),s++,this.options.limit>0&&s>this.options.limit)return o}}return o}}),WayfinderEvents=Class.extend({init:function(){this.events={"map-click":[],"language-change":[]}},listen:function(t,e){"object"!=typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},trigger:function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){var e=t[0];if(t.shift(),this.events[e])for(var i,n=0,o=this.events[e].length;n<o;n++)"function"==typeof(i=this.events[e][n])&&i.apply(this,t)}}}),Building=Class.extend({init:function(t,e){this.name=t["building.name"],this.address=t["building.address"],this.link=new Translations(t["building.link"]),this.description=new Translations(t["building.description"]),this.logoID=t["building.logo"],this.backgroundID=t["building.background"],this.floors={},this.currentFloor=!1},addFloor:function(t){this.floors[t.id]=t},removeFloor:function(t){delete this.floors[t.id]},getFloors:function(){return this.floors},getSortedFloors:function(){return new ArrayUtility(this.floors).sort(function(t,e){return t.index<e.index})},setActiveFloors:function(t){if("object"==typeof t){var e;for(var i in this.floors)"object"==typeof(e=this.floors[i])&&e.setActive&&e.setActive(!1);t.setActive(!0),this.currentFloor=t}},getCurrentFloor:function(){return this.currentFloor},setCurrentFloor:function(t){"object"==typeof t&&(this.currentFloor=t)}}),Settings=Class.extend({init:function(){this.data={}},has:function(t){return t in this.data},get:function(t,e,i){return i&&i.settings.data&&i.settings.data[t]?i.settings.data[t].value:t in this.data?this.data[t]:e},getInt:function(t,e,i){return parseInt(this.get(t,e,i))},getFloat:function(t,e,i){return parseFloat(this.get(t,e,i))},getColor:function(t,e,i){return(new Color).fromHex(this.get(t,e,i))},getBoolean:function(t,e,i){return!0===this.get(t,e,i)},getModel:function(t,e,i){var n=this.getInt(t,0,i);return 0===n?e:n},set:function(t,e){this.data[t]=e},override:function(t){for(var e in t)this.data[e]=t[e]}}),NavigationNode=Class.extend({init:function(t){this.id=t.id,this.floor_id=t.level_id,this.type=t.type,this.position=vec3.fromValues(-parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this.rotation=vec3.fromValues(parseFloat(t.rotation_x),parseFloat(t.rotation_y),parseFloat(t.rotation_z)),this.floor=!1,this.pois=[],this.weight=0,this.zoom=0,this.position2d=vec2.create(),this.neighbours=[],t.weight&&(this.weight=parseFloat(t.weight)),t.zoom&&(this.zoom=parseFloat(t.zoom))},setFloor:function(t){t instanceof Floor&&t.id==this.floor_id&&(this.floor=t)},addPOI:function(t){t instanceof POI&&t.node_id==this.id&&(t.setNode(this),this.pois.push(t))},getID:function(){return this.id},getFloor:function(){return this.floor},getPOIs:function(){return this.pois},setPosition2D:function(t,e){this.position2d=vec2.fromValues(parseFloat(t),parseFloat(e))},setWeight:function(t){this.weight=parseFloat(t)},addNeighbour:function(t){t instanceof NavigationNode&&this.neighbours.push(t)}}),Floor=Class.extend({init:function(t,e){this.id=parseInt(t.id,10),this.name_id=parseInt(t.name_id,10),this.model_id=parseInt(t.model_id,10),this.index=parseInt(t.index,10),this.y=parseFloat(t.y,10),this.lightmap_id=parseInt(t.lightmap_id,10),this.showInMenu=0!==parseInt(t.show_in_menu,10),this.names=new Translations,this.active=!1,this.svg=t.svg;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.nodes=[],this.node3D=!1,this.mapMeshPathToID={},this.mapIDToMeshPath={}},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},addPOI:function(t){t instanceof POI&&(t.setFloor(this),this.pois.push(t))},addNode:function(t){"object"==typeof t&&t.floor_id==this.id&&(t.setFloor(this),this.nodes.push(t))},getPOIs:function(){return this.pois},getNodes:function(){return this.nodes},getShowInMenu:function(){return this.showInMenu},setActive:function(t){this.active=t},getActive:function(){return this.active},setMeshNames:function(t){for(var e in t)this.mapMeshPathToID[t[e]]=parseInt(e),this.mapIDToMeshPath[parseInt(e)]=t[e]},getMeshIDByPath:function(t){return t in this.mapMeshPathToID?this.mapMeshPathToID[t]:0},getMeshPathByID:function(t){return t in this.mapIDToMeshPath&&this.mapIDToMeshPath[t]},showYAH:function(){if(this.node3D){var t=this.node3D.find("YAHLocation/YAH");t&&t.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.enable();var i=t.getComponent(Billboard);i&&i.enable()})}},hideYAH:function(){if(this.node3D){var t=this.node3D.find("YAHLocation/YAH");t&&t.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.disable();var i=t.getComponent(Billboard);i&&i.disable()})}}}),POI=Class.extend({init:function(t,e){this.id=parseInt(t.id),this.type=t.type,this.node_id=parseInt(t.node_id),this.mesh_id=parseInt(t.mesh_id),this.room_id=t.room_id,this.image_id=parseInt(t.image_id),this.icon=null,this.background_id=parseInt(t.background_id),this.background=null,this.showInMenu=0!=parseInt(t.show_in_menu),this.alwaysVisible=0!=parseInt(t.always_visible),this.mesh_name=t.mesh_name,this.settings={},this.names=new Translations,this.descriptions=new Translations,this.hasName=!1;for(var i in e)this.names.set(i,t["names_"+i]),this.descriptions.set(i,t["descriptions_"+i]),this.names.get(i).length>0&&(this.hasName=!0);this.floor=!1,this.node=!1,this.groups=[],this.advertisements=[],this.groupNames={},this.tags="",this.object=!1,this.visible=!1,this.meshNode=!1,this.submesh=!1,this.canvasBoard=!1,this.geometryCreated=!1,this.engine,this.wayfinder},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getDescription:function(t){return this.descriptions.get(t)},getDescriptions:function(){return this.descriptions},getShowInMenu:function(){return this.showInMenu&&this.hasName},setShowInMenu:function(t){this.showInMenu=t},setFloor:function(t){t instanceof Floor&&(this.floor=t)},getFloor:function(){return this.floor},setNode:function(t){"object"==typeof t&&(this.node=t),this.object&&this.node&&mat4.fromTranslation(this.object.transform.relative,this.node.position)},getNode:function(){return this.node},addGroup:function(t){this.groups.push(t)},getGroups:function(){return this.groups},getGroupNames:function(){if(this.groupNames[n])return this.groupNames[n];var t={};for(var e in this.groups)if("object"==typeof this.groups[e]){var i=this.groups[e].getNames();for(var n in i.getAll())t[n]||(t[n]=[]),t[n].push(i.get(n))}return this.groupNames[n]=t,t},addAdvertisement:function(t){this.advertisements.push(t)},getAdvertisements:function(){return this.advertisements},getTags:function(){return this.tags},setTags:function(t){this.tags=t},setIcon:function(t){this.icon=t},getIcon:function(){return this.icon},setBackground:function(t){this.background=t},getBackground:function(){return this.background},getRoomId:function(){return this.room_id},isAlwaysVisible:function(){return this.alwaysVisible},show:function(t){if(this.object){this.geometryCreated||this.createActualGeometry(!0);this.visible=!0,this.object.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.enable();var i=t.getComponent(Billboard);i&&i.enable();var n=t.getComponent(DistanceScalingComponent);n&&n.enable()})}},hide:function(){this.object&&(this.visible=!1,this.object.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.disable();var i=t.getComponent(Billboard);i&&i.disable();var n=t.getComponent(DistanceScalingComponent);n&&n.disable()}))},highlight:function(){this.object&&(this.geometryCreated||this.createActualGeometry(!0),this.object.onEachChildComponent(function(t){t instanceof POIComponent&&t.startHighlight()}))},stopHighlight:function(){this.object&&this.object.onEachChildComponent(function(t){t instanceof POIComponent&&t.stopHighlight()})},dehighlight:function(){this.object&&this.object.onEachChildComponent(function(t){t instanceof POIComponent&&t.dehighlight()})},startAnimating:function(){this.object&&(this.geometryCreated||this.createActualGeometry(),this.object.onEachChild(function(t){var e=t.getComponent(AnimationComponent);e&&e.startAnimating()}))},setAnimation:function(t,e,i){this.object&&this.object.onEachChild(function(n){var o=n.getComponent(AnimationComponent);o&&(t&&o.setLowestPosition(t),e&&o.setHighestPosition(e),i&&o.setAnimationSpeed(i))})},stopAnimating:function(){this.object&&this.object.onEachChild(function(t){var e=t.getComponent(AnimationComponent);e&&e.finishAnimating()})},createGeometry:function(t,e){this.engine=t,this.wayfinder=e,this.object=new Node("POILocation"),this.alwaysVisible&&this.createActualGeometry()},createActualGeometry:function(t){var e=this.wayfinder.settings.getBoolean("poi.3d.billboard",!1,this),i=this.wayfinder.settings.getBoolean("poi.3d.billboard-clickable",!0,this),n=this.wayfinder.settings.getBoolean("poi.3d.height-from-floor-enabled",!0,this),n=this.wayfinder.settings.getBoolean("poi.3d.height-from-floor-enabled",!0,this),o=this.wayfinder.settings.getInt("poi.text.wrap",-1,this),s=this.wayfinder.settings.getBoolean("poi.3d.enable-canvas-board",!1,this),r=this.wayfinder.settings.getBoolean("poi.map.only-text",!1,this);0==this.mesh_id&&(e=!1);var a={billboardClickable:i,heightFromFloor:n,disableBillboard:e,wordWrap:o};s?this.createCanvasBoard(this.engine,this.wayfinder,a):this.image_id>0&&!r?this.createIconGeometry(this.engine,this.wayfinder,a):this.createNameGeometry(this.engine,this.wayfinder,a),this.geometryCreated=!0,this.applySettings(this.wayfinder.settings,t)},createIconGeometry:function(t,e,i){var n=new TextureDescriptor(this.image_id);n.loadAsImage=!0;var o=new Material(t.assetsManager.addShaderSource("Transparent"),{diffuse:new UniformColor(new Color)},[new Sampler("diffuse0",t.assetsManager.texturesManager.addDescriptor(n))]);t.assetsManager.texturesManager.load(function(){}),o.name="POI_icon_"+this.getID(),o.shader.requirements.transparent=!0;var s=Primitives.plane(1,1,o);s.name="POI";var r=s.getComponent(MeshRendererComponent);r.disable(),r.castShadows=!1,r.lightContribution=0,i.billboardClickable&&s.addComponent(new MeshCollider),i.disableBillboard||s.addComponent(new Billboard(t.scene.camera,!0)),s.addComponent(new DistanceScalingComponent(t.scene.camera)),s.addComponent(new AnimationComponent);var a=new POIComponent(this,e.getKioskNode());a.heightFromFloor=i.heightFromFloor,s.addComponent(a),s.layer=Layers.POI,mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(s)},createNameGeometry:function(t,e,i){var n=Primitives.text(this.getName(e.translator.getLanguage()),i.wordWrap);i.billboardClickable&&n.addComponent(new MeshCollider);var o=new POIComponent(this,e.getKioskNode());o.heightFromFloor=i.heightFromFloor,n.addComponent(o),n.addComponent(new DistanceScalingComponent(t.scene.camera)),i.disableBillboard||n.addComponent(new Billboard(t.scene.camera,!0)),n.addComponent(new AnimationComponent),n.getComponent(TextRendererComponent).castShadows=!1,n.getComponent(TextRendererComponent).lightContribution=0,n.getComponent(TextRendererComponent).disable(),n.layer=Layers.POI;var s=n.getComponent(TextComponent);s.family="Tahoma, Geneva, sans-serif",s.color.set(1,1,1,1),s.outlineColor.set(0,0,0,1),mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(n)},createCanvasBoard:function(t,e,i){this.canvasBoard=Primitives.canvasBoard(256,256),this.canvasBoard.name="POI",i.billboardClickable&&this.canvasBoard.addComponent(new MeshCollider);var n=new POIComponent(this,e.getKioskNode());n.heightFromFloor=i.heightFromFloor,this.canvasBoard.addComponent(n),this.canvasBoard.addComponent(new DistanceScalingComponent(t.scene.camera)),i.disableBillboard||this.canvasBoard.addComponent(new Billboard(t.scene.camera,!0)),this.canvasBoard.addComponent(new AnimationComponent),this.canvasBoard.getComponent(CanvasBoardRendererComponent).castShadows=!1,this.canvasBoard.getComponent(CanvasBoardRendererComponent).lightContribution=0,this.canvasBoard.getComponent(CanvasBoardRendererComponent).disable(),this.canvasBoard.layer=Layers.POI,mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(this.canvasBoard)},getCanvasBoard:function(){return!!this.canvasBoard&&this.canvasBoard.getComponent(CanvasBoardComponent)},createPOISignOnMeshGeometry:function(t,e){var i=Primitives.text(this.getName(e.translator.getLanguage())),n=new Node("DebugLine"),o=n.addComponent(new LineRendererComponent(new Color(1,0,1,1)));o.overlay=!0,i.addComponent(new POIComponent(this,e.getKioskNode(),o)),i.getComponent(TextRendererComponent).castShadows=!1,i.getComponent(TextRendererComponent).lightContribution=0,i.getComponent(TextRendererComponent).disable();var s=i.getComponent(TextComponent);s.family="Tahoma, Geneva, sans-serif",s.color.set(1,1,1,1),s.outlineColor.set(0,0,0,1),this.object=new Node("POILocation"),mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(i),mat4.fromTranslation(n.transform.relative,vec3.fromValues(-this.node.position[0],0,-this.node.position[2])),this.object.addNode(n)},linkMesh:function(){if(0!==this.mesh_id&&this.object&&this.floor&&this.floor.node3D){var t=this.object.find("/POIController").getComponent(POIController).getMeshInfoByID(this.mesh_id);if(!1!==t){var e=t.path.split("/");if(!(e.length<2)){var i=parseInt(e.pop().substring(5)),n=e.join("/");if(!(i<0)){if(this.meshNode=t.floor.node3D.find(n),!this.meshNode){if(!(t.floor.node3D.subnodes.length>0))return;for(var o=0;o<t.floor.node3D.subnodes.length&&(this.meshNode=t.floor.node3D.subnodes[o].find(e[1]),!this.meshNode);o++);if(!this.meshNode)return}var s=this.meshNode.getComponent(MeshComponent);s&&(i<s.mesh.submeshes.length&&(this.submesh=s.mesh.submeshes[i]),this.setDistanceScalingByMesh&&this.object.onEachChildComponent(function(t){t instanceof DistanceScalingComponent&&(t.maxScale=Math.min(s.mesh.boundingSphere.radius/2,t.maxScale))}))}}}}},applySettings:function(t,e){if(this.object){var i=this;this.object.onEachChildComponent(function(n){if(n instanceof POIComponent){if(n.offsetY=t.getFloat("poi.3d.offset",0,i),n.width=t.getFloat("poi.width",1,i),n.height=t.getFloat("poi.height",1,i),n.highlightColors[0]=t.getColor("poi.highlight.color1","#ff0000ff",i).toVector(),n.highlightColors[1]=t.getColor("poi.highlight.color2","#0000ffff",i).toVector(),n.dehighlightColor=t.getColor("poi.dehighlight.color","#888888ff",i).toVector(),n.highlightDuration=t.getFloat("poi.highlight.duration",5,i),n.highlightSpeed=t.getFloat("poi.highlight.speed",1,i),n.textSize=t.getFloat("poi.text.size",1,i),n.textColor=t.getColor("poi.text.color","#FFFFFF",i),n.outline=t.getBoolean("poi.text.outline",!1,i),n.outlineColor=t.getColor("poi.text.outline-color","#000000",i),n.outlineWidth=t.getInt("poi.text.outline-width",5,i),n.backgroundColor=t.getColor("poi.text.background-color","#00000000",i),n.disableBillboard=t.getBoolean("poi.3d.billboard",!1,i),n.billboardClickable=t.getBoolean("poi.3d.billboard-clickable",i),t.getBoolean("poi.3d.meshgroupcolor",!1,i)&&i.groups.length>0&&i.groups[0]){var o=i.groups[0];n.groupColor=o.getColor().toVector()}e&&n.onStart()}else n instanceof DistanceScalingComponent?(n.doingIt=t.getBoolean("poi.distancescaling.enabled",!1,i),n.maxScale=t.getFloat("poi.distancescaling.maxscale",15,i),t.getBoolean("poi.distancescaling.mesh",!1,i)&&(i.setDistanceScalingByMesh=!0)):n instanceof AnimationComponent&&(t.getBoolean("path.animation.poi",!1,i)||n.disable())})}}}),POIAdvertisement=Class.extend({init:function(t,e,i){this.id=e.id,this.image_id=e.image_id,this.text1={},this.text2={},this.link={},this.poi=t;for(var n in i)this.link[n]=e["link_"+n],e["text1_"+n]?this.text1[n]=e["text1_"+n]:this.text1[n]=e["menu_"+n],e["text2_"+n]?this.text2[n]=e["text2_"+n]:this.text2[n]=e["3d_"+n]},getID:function(){return this.id},getPOI:function(){return this.poi},getText1:function(t){return t in this.text1&&this.text1[t]},getText2:function(t){return t in this.text2&&this.text2[t]},getLink:function(t){return t in this.link&&this.link[t]}}),POIGroup=Class.extend({init:function(t,e){this.id=t.group_id,this.names=new Translations,this.imageID=t.image_id;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.showInMenu=t.show_main,this.showInTopMenu=t.show_top,this.color=(new Color).fromHex(t.color),this.parent_id=t.parent_id},getID:function(){return this.id},getNames:function(){return this.names},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getShowInMenu:function(){return 0!=this.showInMenu},getShowInTopMenu:function(){return 0!=this.showInTopMenu},getImageID:function(){return this.imageID},addPOI:function(t){this.pois.push(t)},getPOIs:function(){return this.pois},getColor:function(){return this.color}}),Logistics=function(){var t=!1;"undefined"!=typeof window&&(t="localStorage"in window&&null!==window.localStorage);var e=[],i=[],n={},o=0,s=!1,r=null,a=null,h=null,d=null,c={loadFromLocalStorage:!1,storeToLocalStorage:!1,loadFromFile:!1,enableCORS:!0,useCookies:!1,fallbackFromStorage:!0,urlParseFunction:null},l={text:{load:function(t){P(t)},parse:function(t,e){t.data=e.responseText},store:function(t){return t.data},restore:function(t,e){return e}},json:{load:function(t){P(t)},parse:function(t,e){try{t.data=JSON.parse(e.responseText)}catch(e){"undefined"!=typeof console&&console.error&&console.error("JSON parsing failed for "+t.url,e)}},store:function(t){return JSON.stringify(t.data)},restore:function(t,e){return e?JSON.parse(e):{}}},xml:{load:function(t){P(t)},parse:function(t,e){e.responseXML?t.data=e.responseXML:t.data=I(e.responseText)},store:function(t){return XMLSerializer?(new XMLSerializer).serializeToString(t.data):""},restore:function(t,e){return I(e)}},image:{load:function(t){t&&(t.data=new Image,t.useCORS&&(t.data.crossOrigin="Anonymous"),t.data.onload=function(){t.ready()},t.data.onerror=function(){t.failed()},t.data.src=t.url)},parse:function(t){},store:function(t){var e=document.createElement("canvas");e.width=t.data.width,e.height=t.data.height;e.getContext("2d").drawImage(t.data,0,0);var i=e.toDataURL("image/png");return e=null,i},restore:function(t,e){var i=new Image;return i.src=e,i}},binary:{load:function(t){P(t)},parse:function(t,e){t.data=e.response},store:function(t){for(var e="",i=new Uint8Array(t.data),n=i.byteLength,o=0;o<n;o++)e+=String.fromCharCode(i[o]);return window.btoa(e)},restore:function(t,e){for(var i=new ArrayBuffer(2*e.length),n=new Uint16Array(i),o=0,s=e.length;o<s;o++)n[o]=e.charCodeAt(o);return i}}},u=function(t,i,n,s,r){var a="GET";"function"==typeof i?(r=n,n=i,i=void 0):i&&"object"==typeof i&&(a="POST"),"function"==typeof c.urlParseFunction&&(t=c.urlParseFunction(t));var h=new function(t,e,i,n,s,r){this.url=t,this.params=e,this.success=i,this.dataType=n,this.loaded=!1,this.data=!1,this.requestType=s,this.useCORS=!1,this.options=r||{},this.successCallback=i,this.errorCallback=!1,this.alwaysCallback=!1,this.progressCallback=!1,this.setOption=function(t,e){this.options[t]=e},this.getOption=function(t){return this.options[t]},this.ready=function(){this.loaded=!0,o++,W(this),O(this)},this.failed=function(){o++,O(this),x(this)},this.done=function(t){this.successCallback=t},this.fail=function(t){this.errorCallback=t},this.error=function(t){this.errorCallback=t},this.always=function(t){this.alwaysCallback=t},this.progress=function(t){this.progressCallback=t},this.toString=function(){return this.data}}(t,i,n,s,a,r);return c.enableCORS&&(h.useCORS=f(t)),h&&(e.push(h),g(h)),h},f=function(t){if("undefined"==typeof document)return!1;var e=t.match(/(https?:)?\/\/([^\/]+)\/(.*)/);return!!e&&(!document||e[1]!==document.location.origin)},g=function(t){return p(t),!0},p=function(t){!function(t){if(t){var e=t.getOption("stage");e&&("object"!=typeof n[e]&&(n[e]=[]),n[e].push(t))}}(t),c.loadFromLocalStorage&&m(t)?y(t):v(t.dataType,"load")(t)},m=function(e){return!(!t||null===localStorage.getItem(e.url))},y=function(t){t.data=v(t.dataType,"restore")(t,b(t)),t.ready()},v=function(t,e){return l&&l[t]&&l[t][e]?l[t][e]:l&&l[t]?l[t]:function(){"undefined"!=typeof console&&console.warn&&console.warn("Method "+e+" for "+t+" not found")}},P=function(t){var e=w(t);if(!e||!t)throw"http failed";var i=t.url,n=null;if(e.open(t.requestType,i,!0),e.overrideMimeType&&e.overrideMimeType("text/xml"),"binary"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/x-3dtechdata")),"default"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/octet-stream")),t.options.headers)for(var o in t.options.headers)e.setRequestHeader(o,t.options.headers[o]);if(t.params){n=new FormData;for(var s in t.params)n.append(s,t.params[s])}t.useCORS&&c.useCookies&&(e.withCredentials=!0),e.onreadystatechange=function(){if(4==e.readyState){var i=e.status;200==i||0==i||300==i?(v(t.dataType,"parse")(t,e),t.ready()):t.failed()}else"function"==typeof t.progressCallback&&t.progressCallback(e)},e.ontimeout=function(){t.failed()},e.onerror=function(){t.failed()},O(t),e.send(n)},I=function(t){var e=null;if(!t||"string"!=typeof t)return e;if(window&&window.DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else(e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(t);if(!e||e.getElementsByTagName("parsererror").length)throw"XML parsing failed";return e},w=function(t){var e=!1;if(t.useCORS&&window&&window.XDomainRequest)try{e=new XDomainRequest}catch(t){e=!1}else if(XMLHttpRequest)try{e=new XMLHttpRequest}catch(t){e=!1}else if("undefined"!=typeof ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP"),alert(2)}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP"),alert(3)}catch(t){e=!1}}return e},A=function(e){if(t)try{localStorage[e.url]=v(e.dataType,"store")(e)}catch(t){console.warn("localStorage limit exceeded")}else console.warn("localStorage isn't supported")},b=function(t){return localStorage[t.url]},W=function(t){t&&"function"==typeof t.successCallback&&(t.successCallback(t.data,"success",t),L()),t&&c.storeToLocalStorage&&A(t)},x=function(t){if(t&&c.fallbackFromStorage&&m(t))y(t);else{if(!t||"function"!=typeof t.errorCallback)throw"Resource "+t.url+" not loaded";t.errorCallback(t,"error",""),L()}},O=function(t){a&&"function"==typeof a&&e.length&&o&&a(o/e.length),t&&t.getOption("stage")&&C(t)},C=function(t){if(h&&"function"==typeof h){for(var e=n[t.getOption("stage")],i=e.length,o=0,s=0;s<i;s++)e[s]&&e[s].loaded&&o++;i>0&&h(t.getOption("stage"),o/i)}},L=function(){null===d&&(d=setTimeout(M,5))},M=function(){d=null,e.length==o&&r&&"function"==typeof r&&r()},S=function(t,e){return function(){return e.apply(t,arguments)}};return{count:function(){return e.length},loadedCount:function(){return o},clear:function(){e=[],i=[],o=0,s=!1},get:function(t,e,i,n,o){return u(t,e,i,toLowerCase(n),o)},getJSON:function(t,e,i,n){return u(t,e,i,"json",n)},getImage:function(t,e,i,n){return u(t,e,i,"image",n)},getBinary:function(t,e,i,n){return u(t,e,i,"binary",n)},getXML:function(t,e,i,n){return u(t,e,i,"xml",n)},getText:function(t,e,i,n){return u(t,e,i,"text",n)},getMultiple:function(t,e,n){!function(t,e,n){var o=new function(t,e,i){this.urls=t,this.results={},this.loadedCount=0,this.count=0,this.successCallback=e,i=i||{},this.load=function(){var t=null,e=null;for(var n in this.urls)this.urls.hasOwnProperty(n)&&this.count++;for(var o in this.urls)if((e=this.urls[o])&&e.url&&e.type)try{(t=u(e.url,void 0,S(this,this.ready,o),e.type,JSON.parse(JSON.stringify(i)))).setOption("logistics.multi.key",o),t.fail(S(this,this.fail))}catch(t){this.fail()}},this.ready=function(t,e,i){var n=i.getOption("logistics.multi.key");this.results[n]=t,this.loadedCount++,this.checkIfAllReady()},this.fail=function(t){this.loadedCount++,this.checkIfAllReady()},this.getKeyForURL=function(t){},this.checkIfAllReady=function(){this.loadedCount>=this.count&&"function"==typeof this.successCallback&&this.successCallback(this.results)}}(t,e,n);i.push(o),o.load()}(t,e,n)},store:function(){!function(){if(t)for(var i in e)A(e[i]);else console.warn("localStorage isn't supported")}()},clearStorage:function(){localStorage.clear()},types:function(){return l},onFinishedLoading:function(t){r=t},onProgress:function(t){a=t},onStageProgress:function(t){h=t},getQueue:function(){return e},getTypeFunction:function(t,e){return v(t,e)},setTypeFunction:function(t,e){return function(t,e){t&&e&&(l[t]=e)}(t,e)},getOption:function(t){return function(t){return c[t]}(t)},setOption:function(t,e){!function(t,e){c[t]=e}(t,e)},start:function(){return start()}}}(),Language=Class.extend({init:function(t){this.name=t.name,this.id=t.id,this.nativeName=t.native,this.textDirection=t.text_direction.toLowerCase(),this.flagImage=t.flag},getName:function(){return this.name},getID:function(){return this.id},getNativeName:function(){return this.nativeName},getTextDirection:function(){return this.textDirection}}),Translator=Class.extend({init:function(t,e){this.language=t,this.translations=e},setTranslations:function(t){this.translations=t},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},_isJQueryObject:function(t){return"undefined"!=typeof jQuery&&t instanceof jQuery},get:function(t,e){if(this.translations&&t&&this.translations[t]&&this.translations[t][this.language]){var i=this.translations[t][this.language];return e&&(i=this.replaceValues(i,e)),i}return t},translate:function(t){if(t&&(this.language=t),"undefined"!=typeof document&&document.querySelectorAll){for(var e=document.querySelectorAll("[data-translation-element]"),i=0;i<e.length;i++)this.translateElement(e[i],e[i].getAttribute("data-translation-element"));for(var e=document.querySelectorAll("[data-translation-attributes]"),i=0;i<e.length;i++)for(var n=e[i].getAttribute("data-translation-attributes").split(","),o="",s=0;s<n.length;s++)o=e[i].getAttribute("data-translation-attribute-"+n[s]),e[i]&&o&&e[i].setAttribute(n[s],this.get(o))}},setElement:function(t,e){t&&e&&(this._isJQueryObject(t)&&(t=t[0]),t.setAttribute("data-translation-element",e))},setAttribute:function(t,e,i){if(t&&i&&e){this._isJQueryObject(t)&&(t=t[0]);var n=[];t.getAttribute("data-translation-attributes")&&(n=t.getAttribute("data-translation-attributes").split(",")),n.push(e),t.setAttribute("data-translation-attributes",n.join(",")),t.setAttribute("data-translation-attribute-"+e,i)}},translateElement:function(t,e,i){if(t)if(this._isJQueryObject(t)&&(t=t[0]),e&&this.exists(e)){var n=this.get(e,i);this.setElement(t,e),t.innerHTML=n}else t.classList&&t.classList.add("no-translation")},translateAttribute:function(t,e,i,n){if(t&&e&&i){this._isJQueryObject(t)&&(t=t[0]);var o=this.get(i,n);this.setAttribute(t,e,i),t.setAttribute(e,o),!this.exists(i)&&t.classList&&t.classList.add("no-translation")}},replaceValues:function(t,e){if(t&&e){var i=0;for(var n in e)t=t.replace("%"+i++,e[n])}return t},exists:function(t){return!!(this.translations&&t&&this.translations[t]&&this.translations[t][this.language])}}),Translations=Class.extend({init:function(t){this.translations=t||{}},set:function(t,e){this.translations[t]=e},get:function(t){return!!this.translations[t]&&this.translations[t]},setAll:function(t){this.translations=t},getAll:function(){return this.translations},setTranslations:function(t,e){if(t&&e){for(var i in this.translations)t.attr("data-lang-"+i,this.translations[i]);this.translations[e]?t.html(this.translations[e]):t.html("no translation"),t.attr("data-translated",!0)}}}),TranslationsMap=Class.extend({init:function(){this.translations={}},add:function(t,e){if(!(e instanceof Translations))throw"Only Translation instances can be added to translations map";this.translations[t]=e},get:function(t){return this.translations[t]?this.translations[t]:new Translations({english:"--missing--"})}}),WFStatistics=Class.extend({init:function(t){this.wayfinder=t,this.session_id=0,this.storageSupport="undefined"!=typeof window&&"localStorage"in window&&null!==window.localStorage,this.storagePrefix="wfstats_",this.device_id=0,this.searchPhrase="",this.checkStorage()},start:function(){var t=this;"undefined"==typeof screen||this.device_id||WayfinderAPI.statistics.device(screen.width,screen.height,this.wayfinder.getKiosk(),function(e){e&&(t.device_id=e.data.id,t.store("deviceId",e.data.id),log("Device created",e))})},onSessionStart:function(){var t=this,e=this.wayfinder.languages[this.wayfinder.getLanguage()];e&&e.getID()&&this.wayfinder.getKiosk()&&WayfinderAPI.statistics.startSession(e.getID(),this.wayfinder.getKiosk(),this.wayfinder.options.application,this.wayfinder.getLayout(),this.device_id,function(e){try{e&&(t.session_id=e.data)}catch(t){log("Something went wrong sending startSession")}})},onSessionEnd:function(){var t=this;if(this.session_id){var e=this.wayfinder.languages[this.wayfinder.getLanguage()];WayfinderAPI.statistics.endSession(this.session_id,e.getID(),function(){t.session_id=0,log("Session ended!")})}},onClick:function(t,e){WayfinderAPI.statistics.click(t,this.session_id,e)},onLanguageChange:function(t){},onSearch:function(t,e){WayfinderAPI.statistics.search(t,this.session_id,e)},checkStorage:function(){this.storageSupport&&(this.deviceId=localStorage.getItem(this.storagePrefix+"deviceId"))},getTime:function(){},store:function(t,e){this.storageSupport&&(localStorage[this.storagePrefix+t]=JSON.stringify(e))},isOnline:function(){}}),WayfinderLogic=Class.extend({init:function(t,e){this.wayfinder=t,this.name=e},resize:function(){if("undefined"!=typeof document){var t=this.getCanvas();if(t&&"undefined"!=typeof window){var e=window.getComputedStyle(t.parentNode,null);t.setAttribute("width",e.width),t.setAttribute("height",e.height)}}},getCanvas:function(){return!!(this.name&&this.wayfinder&&this.wayfinder.maps[this.name])&&this.wayfinder.maps[this.name].canvas},loadMapData:function(){},showFloor:function(){},onDataLoaded:function(){this.wayfinder.setKiosk(this.wayfinder.options.kiosk),this.wayfinder.showFloor(this.wayfinder.getKioskNode().getFloor()),this.showKiosk(),this.dataLoaded=!0,this.wayfinder.loadSecondaryResources(),this.wayfinder.onFinishedLoading()},loadPOIIcons:function(t){if(this.wayfinder.pois){var e;for(var i in this.wayfinder.pois)(e=this.wayfinder.pois[i]).image_id&&0!==e.image_id&&e.alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","get",[e.image_id]),null,ClassCallback(e,e.setIcon),{stage:"locations"})}}}),WayfinderLogic2D=WayfinderLogic.extend({init:function(t,e){this._super(t,e),this.map=t.map,this.currentFloor=!1,this.factory=new WayfinderFactory2D(this.wayfinder)},cbOnZoomChange:function(){this.wayfinder.cbOnZoomChange()},loadMapData:function(){Logistics.getJSON(WayfinderAPI["2d"].pack.url(),null,ClassCallback(this,this.onMapData),{stage:"map"})},onMapData:function(t){var e=this,i=t.data;this.factory.addNode2DData(i.nodes),this.factory.createOverlays(i.overlays);var n=this.wayfinder.settings.getInt("kiosk.you-are-here-image",0),o=0!==n?WayfinderAPI.getURL("images","get",[n]):"images/yah.png";Logistics.getImage(o,function(t,i){e.wayfinder.yahImage=t}),this.wayfinder.padding=this.wayfinder.settings.getInt("path.2d.padding",this.wayfinder.options.pathZoomPadding),this.setup(),this.loadMapImages(),this.wayfinder.resize(),this.wayfinder.cbOnMapReady&&"function"==typeof this.wayfinder.cbOnMapReady&&this.wayfinder.cbOnMapReady(),this.loadPOIIcons(),this.onDataLoaded(),this.wayfinder.map.start(),this.wayfinder.map.update(!0),this.showKiosk()},onDataLoaded:function(){if(this._super(),this.cbOnDataLoaded&&"function"==typeof this.cbOnDataLoaded&&this.cbOnDataLoaded(),this.wayfinder.getCurrentFloor())if(this.wayfinder.settings.getBoolean("camera.2d.disablezooming",!1))this.showKiosk();else{var t=this.wayfinder.building.getFloors()[this.wayfinder.getCurrentFloor().id];"object"==typeof t&&this.map.fitMultiplePOIsInView(t.pois)}},setup:function(){this.map=new Map2D(this.wayfinder),this.wayfinder.map=this.map,this.map.setup(),this.map.onPOIClick=ClassCallback(this.wayfinder,this.wayfinder.onPOIClick),this.map.getTransformer().cbOnZoomChange=ClassCallback(this.wayfinder,this.wayfinder.onZoomChange)},loadMapImages:function(){var t,e=this,i=function(t,i,n){e.wayfinder.map.addLODImage(n.params.floor_id,0,0,0,t)};for(var n in this.wayfinder.building.getFloors())t=this.wayfinder.building.getFloors()[n],Logistics.getImage(WayfinderAPI.getURL("2d","image",[t.id]),{floor_id:t.id},i,{stage:"floors"})},setDefaultView:function(t){this.wayfinder.pathComponent&&this.wayfinder.pathComponent.clearPath(),this.setKioskView(t)},setNodeView:function(t,e,i){},showPath:function(t,e,i){if(!1!==t&&!1!==e){var n=new PathFinder2D(this.wayfinder.nodes);if(this.path=n.find(t.id,e.id),!1!==this.path){var o=this;return this.wayfinder.settings.getBoolean("camera.2d.disableMap2DMovement",!1)||this.wayfinder.settings.getBoolean("camera.2d.disableZooming",!1)||this.wayfinder.map.fitPathInView(this.path),this.wayfinder.map.pathRenderer.reset(),console.log("wayfinder.showFloor(sourceNode.floor)",t.floor),this.wayfinder.showFloor(t.floor),this.wayfinder.map.redraw(),this.wayfinder.map.pathRenderer.setPath(this.path,function(){i&&(o.clearHighlights(),o.clearDisplaying(),o.setHighlights([i]),o.setDisplaying([i])),o.wayfinder.map.redraw(),"function"==typeof o.cbOnPathFinished&&o.wayfinder.cbOnPathFinished(o.path,e,i)}),this.path}}},updatePath:function(t,e,i){if(!1!==this.wayfinder.getKiosk()&&!1!==e){var n=new PathFinder2D(this.wayfinder.nodes);if(this.path=n.find(t.id,e.id),!1!==this.path){var o=this;return this.map.pathRenderer.reset(),this.map.redraw(),this.map.pathRenderer.updatePath(this.path,function(){i&&(o.clearHighlights(),o.setHighlights([i])),o.map.redraw(),"function"==typeof o.cbOnPathFinished&&o.cbOnPathFinished(o.path,e,i)}),this.path}console.log("updatePath","No path found",t,e)}},getNearestPOIs:function(t,e,i){for(var n,o,s=new PathFinder2D(this.wayfinder.nodes),r=[],a=0,h=e.length;a<h;a++)if((o=e[a])&&o.node&&o.node.position2d){if(i&&vec2.dist(t.position2d,o.node.position2d)>=i)continue;(n=s.find(t.id,o.node.id))?i>=n.getDistance()&&r.push(o):console.log("No path for",o)}return r},resize:function(){if(this._super(),this.map){var t=1;if(this.wayfinder.options.upscale>0){var e=this.map.renderer.context,i=window.devicePixelRatio||1,n=this.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t=Math.max(this.wayfinder.options.upscale,i/n)}var o=this.getCanvas();this.map.resize(o,o.width*t,o.height*t,t),this.map.redraw()}},setZoom:function(t){this.map.setZoom(t),this.map.update(!0)},zoomIn:function(){this.map.zoomIn(),this.map.update(!0)},zoomOut:function(){this.map.zoomOut(),this.map.update(!0)},setHighlights:function(t){this.map.setHighlights(t),this.map.update(!0)},clearHighlights:function(){this.map.clearHighlights(),this.map.update(!0)},clearDisplaying:function(){this.map.clearDisplaying(),this.map.update(!0)},setDisplaying:function(t){this.map.setDisplaying(t),this.map.update(!0)},showFloor:function(){this.wayfinder.map&&this.wayfinder.map.update(!0)},showKiosk:function(){if(!1!==this.wayfinder.getKiosk()){this.wayfinder.map.pathRenderer.reset(),this.wayfinder.showFloor(this.wayfinder.getKioskNode().floor);var t=this.wayfinder.getCurrentFloor();t&&(!this.wayfinder.settings.getBoolean("camera.2d.disableZooming",!1)||this.wayfinder.settings.getBoolean("kiosk.view.fit-floor-pois",!1)?this.wayfinder.map.fitMultiplePOIsInView(this.wayfinder.building.getFloors()[t.id].pois):this.setZoom(0)),this.wayfinder.map.redraw()}},clearPath:function(){this.map.pathRenderer.clearPath(),this.map.pathRenderer.reset(),this.map.update(!0)},setLanguage:function(t){this._super(t),this.map.update(!0)},switchCanvas:function(t){this.canvas=t,this.map.updateCanvas(this.canvas),this.resize(),this.map.update(!0)},findNearestNodeOnFloor:function(t,e,i){return this.map.findNearestNodeOnFloor(t,e,i)},pause:function(){this.paused=!0},run:function(){this.paused=!1},onVisibilityChange:function(){"undefined"!=typeof document&&document.hidden?this.pause():this.run()},getScreenPosition:function(t){return this.map.getPOIOverlayLocationOnMap(t)},update:function(t){this.map&&this.map.update(t)},switchCanvas:function(t){this.wayfinder.maps[this.name].canvas=t,this.map.updateCanvas(t),this.resize(),this.map.update(!0)}}),WayfinderFactory2D=WayfinderFactory.extend({createOverlays:function(t){if(t){var e,i;for(e in t)if(e in this.wayfinder.pois){this.wayfinder.overlays[e]||(this.wayfinder.overlays[e]=[]);for(i in t[e])this.wayfinder.overlays[e].push(new Overlay(this.wayfinder.pois[e],t[e][i],this.wayfinder.options.map2DRotation))}}},addNode2DData:function(t){if(this.wayfinder.nodes)for(var e in this.wayfinder.nodes){var i=this.wayfinder.nodes[e];if(t[i.floor_id]){var n=t[i.floor_id][i.id];n&&(i.setPosition2D(n.x,n.y),i.setWeight(n.weight))}}},createNode:function(t){return new NavigationNode2D(t)}}),Wayfinder2D=Wayfinder.extend({init:function(t,e){t&&t instanceof Wayfinder2DOptions||(t=new Wayfinder2DOptions),this._super(t,new WayfinderFactory2D(this)),this.logic=new WayfinderLogic2D(this,"2d"),this.overlays={},this.adImage=!1,this.yahImage=!1,this.paused=!1,this.path=!1,e||"undefined"==typeof document||(e=document.getElementById(this.options.map)),this.maps["2d"]={logic:this.logic,canvas:e,loaded:!1}},onBundleData:function(t){this._super(t),this.logic.loadMapData()},isCanvasSupported:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},onPOIsLoaded:function(t){this._super(t),Logistics.getMultiple({nodes_2d:{url:WayfinderAPI.getURL("2d","nodes",[]),type:"json"},overlays:{url:WayfinderAPI.getURL("2d","overlays",[]),type:"json"},location:{url:WayfinderAPI.getURL("building","location",[]),type:"json"},lodcount:{url:WayfinderAPI.getURL("2d","lodcount",[]),type:"json"},"ad-image":{url:"images/ad.png",type:"image"},"yah-image":{url:"images/yah.png",type:"image"}},ClassCallback(this,this.on2DDataLoaded),{stage:"settings"}),this.loadMapImages()},on2DDataLoaded:function(t){var e=t.nodes_2d.data,i=t.overlays.data;this.adImage=t["ad-image"],this.yahImage=this.settings.getInt("kiosk.you-are-here-image",0)?this.settings.getInt("kiosk.you-are-here-image",0):t["yah-image"],this.options.maxLOD=t.lodcount.data,console.log("nodes",e),this.factory.addNode2DData(e),this.factory.createOverlays(i),this.map.update(!0),this.onDataLoaded()},onDataLoaded:function(){this._super()},overrideOptions:function(){this.options.disableMap2DMovement=this.settings.getBoolean("camera.2d.disableMap2DMovement",!1)},setupFloor:function(){var t=!1;if(this.getKioskNode()&&this.getKioskNode().floor)t=this.getKioskNode().floor;else{var e=0;for(var i in this.building.getFloors())(t=this.building.getFloors()[i]).index>=e&&(e=t.index)}t&&this.showFloor(t)}}),Wayfinder2DOptions=WayfinderOptions.extend({init:function(){this._super(),this.pathZoomPadding=50,this.pathStride=10,this.poiColor="rgba(100,100,100,0.5)"}}),NavigationNode2D=NavigationNode.extend({init:function(t){this._super(t),this.position2d=!1,this.weight=!1,this.neighbours=[]},setPosition2D:function(t,e){this.position2d=vec2.fromValues(parseFloat(t),parseFloat(e))},setWeight:function(t){this.weight=parseFloat(t)},addNeighbour:function(t){t instanceof NavigationNode2D&&this.neighbours.push(t)}}),Overlay=Class.extend({init:function(t,e,i){this.visible="1"==e.visible,this.polygon=this.createPolygon(e.polygon),this.poi=t,this.rotate=i||0,this.bounds=this.calculateBounds(this.polygon,0),this.rotatedAreaBounds=this.calculateRotatedAreaBounds(this.polygon)},createPolygon:function(t){var e=[];if(t)for(var i=0;i<t.length;i++)t[i]&&t[i].x&&t[i].y&&e.push(vec2.fromValues(t[i].x,t[i].y));return e},contains:function(t){var e,i,n=!1;for(e=0,i=this.polygon.length-1;e<this.polygon.length;i=e++)this.polygon[e][1]>t[1]!=this.polygon[i][1]>t[1]&&t[0]<(this.polygon[i][0]-this.polygon[e][0])*(t[1]-this.polygon[e][1])/(this.polygon[i][1]-this.polygon[e][1])+this.polygon[e][0]&&(n=!n);return n},calculateBounds:function(t,e){if(!t)return!1;for(var i,n=1/0,o=1/0,s=-1/0,r=-1/0,a=0;a<t.length;a++)i=t[a],e&&(i=this.rotatePoint(i,e)),n=Math.min(n,i[0]),o=Math.min(o,i[1]),s=Math.max(s,i[0]),r=Math.max(r,i[1]);return i=this.rotatePoint(vec2.fromValues(n,o),-e),[i[0],i[1],s-n,r-o,s,r]},calculateArea:function(t){var e,i,n,o,s=0;for(e=0,i=t.length-1;e<t.length;i=e,e++)n=t[e],o=t[i],s+=n[0]*o[1],s-=n[1]*o[0];return s/=2},calculateCenter:function(t){for(var e=vec2.create(),i=0;i<t.length;i++)vec2.add(e,e,t[i]);return vec2.divide(e,e,vec2.fromValues(t.length,t.length))},calculateRotatedAreaBounds:function(t,e){var i,n,o,s,r,a,h,d,c,l,u,f,g,p,m,y,v,P,I,w,A,b,W,x,O,C,L,M,S,R,D,T,N,U,F,z,E,_,V,B,H,Z,J,j,q,X;if("array"==typeof t&&t.length<3)return null;if([],.5,5,null==e&&(e={}),e.maxAspectRatio=15,e.minWidth=0,e.minHeight=0,e.tolerance=3,e.nTries=20,r=[-90,-30,0,30,90],0===Math.abs(this.calculateArea(t)))return null;if(A=this.bounds[4]-this.bounds[2],b=this.bounds[5]-this.bounds[3],y=this.bounds[4],v=this.bounds[5],Z=Math.min(y-A,v-b)*e.tolerance,H=function(){var e,i,n;for(n=[],e=0,i=t.length;e<i;e++)L=t[e],n.push({x:L[0],y:L[1]});return n}(),Z>0&&(H=this.findConvexHull(H,Z),t=function(){var t,e,i;for(i=[],t=0,e=H.length;t<e;t++)L=H[t],i.push([L[0],L[1]]);return i}()),[[A,b],[y,b],[y,v],[A,v]],h=Math.abs(y-A),a=Math.abs(v-b),j=Math.min(h,a)/50,!C){C=[],d=this.calculateCenter(t),this.pointInPoly(d,t)&&C.push(d);for(var Y=0;C.length<e.nTries;)if(V=Math.random()*h+A,B=Math.random()*a+b,_=[V,B],this.pointInPoly(_,t)&&C.push(_),++Y>15e3)return console.log("Failed to find bounds",t.length,this.poi.getName("en")),!1}u=0,p=null;for(var G=0,K=r.length;G<K;G++){s=-(o=r[G])*Math.PI/180;for(var Q=k=0,$=C.length;k<$;Q=++k){x=C[Q],S=(N=this.intersectPoints(t,x,s))[0],D=N[1],M=(U=this.intersectPoints(t,x,s+Math.PI/2))[0],R=U[1],W=[],null!=S&&null!=D&&W.push([(S[0]+D[0])/2,(S[1]+D[1])/2]),null!=M&&null!=R&&W.push([(M[0]+R[0])/2,(M[1]+R[1])/2]);for(var tt=0,et=W.length;tt<et;tt++)if(O=W[tt],F=this.intersectPoints(t,O,s),S=F[0],D=F[1],null!==S&&null!==D&&(w=Math.min(this.squaredDist(O,S),this.squaredDist(O,D)),m=2*Math.sqrt(w),z=this.intersectPoints(t,O,s+Math.PI/2),M=z[0],R=z[1],null!==M&&null!==R&&(I=Math.min(this.squaredDist(O,M),this.squaredDist(O,R)),g=2*Math.sqrt(I),!(m*g<u)))){P=Math.max(1,e.minWidth/g,u/(g*g)),f=Math.min(e.maxAspectRatio,m/e.minHeight,m*m/u),n=[];for(Q=P;Q<f+.5;Q+=.5)n.push(Q);for(var it=0,nt=n.length;it<nt;it++)if(i=n[it],l=Math.max(e.minWidth,Math.sqrt(u*i)),!((E=Math.min(m,g*i))*g<u))for(;E-l>=j;)c=(J=(l+E)/2)/i,T=[[(q=O[0])-J/2,(X=O[1])-c/2],[q+J/2,X-c/2],[q+J/2,X+c/2],[q-J/2,X+c/2]],T=this.rotatePoly(T,s,O),this.polyInsidePoly(T,t)?(!0,u=J*c,p={cx:q,cy:X,width:J,height:c,angle:o},l=J):(!1,E=J)}}}return!!p&&{angle:-p.angle*Math.PI/180,bounds:{width:p.width,height:p.height},center:[p.cx,p.cy]}},squaredDist:function(t,e){var i,n;return i=e[0]-t[0],n=e[1]-t[1],i*i+n*n},rayIntersectsSegment:function(t,e,i){var n,o,s,r;return r=e[1]<i[1]?[e,i]:[i,e],n=r[0],o=r[1],t[1]!==o[1]&&t[1]!==n[1]||(t[1]+=Number.MIN_VALUE),!(t[1]>o[1]||t[1]<n[1])&&(!(t[0]>n[0]&&t[0]>o[0])&&(t[0]<n[0]&&t[0]<o[0]||(s=(o[1]-n[1])/(o[0]-n[0]),(t[1]-n[1])/(t[0]-n[0])>s)))},pointInPoly:function(t,e){var i,n,o,s,r;for(s=-1,n=e[(r=e.length)-1],o=0;++s<r;)i=n,n=e[s],this.rayIntersectsSegment(t,i,n)&&o++;return o%2!=0},pointInSegmentBox:function(t,e,i){var n,o;return 1e-9,n=t[0],o=t[1],!(n<Math.min(e[0],i[0])-1e-9||n>Math.max(e[0],i[0])+1e-9||o<Math.min(e[1],i[1])-1e-9||o>Math.max(e[1],i[1])+1e-9)},lineIntersection:function(t,e,i,n){var o,s,r,a,h,d,c,l,u;return 1e-9,a=t[0]-e[0],d=t[1]-e[1],h=i[0]-n[0],c=i[1]-n[1],r=a*c-d*h,Math.abs(r)<1e-9?null:(o=t[0]*e[1]-t[1]*e[0],s=i[0]*n[1]-i[1]*n[0],l=(o*h-s*a)/r,u=(o*c-s*d)/r,[l,u])},segmentsIntersect:function(t,e,i,n){var o;return null!=(o=this.lineIntersection(t,e,i,n))&&this.pointInSegmentBox(o,t,e)&&this.pointInSegmentBox(o,i,n)},polyInsidePoly:function(t,e){var i,n,o,s,r,a,h,d;for(r=-1,h=t.length,d=e.length,o=t[h-1];++r<h;)for(i=o,o=t[r],a=-1,s=e[d-1];++a<d;)if(n=s,s=e[a],this.segmentsIntersect(i,o,n,s))return!1;return this.pointInPoly(t[0],e)},rotatePoint:function(t,e,i){var n,o,s,r;return null==i&&(i=[0,0]),s=t[0]-i[0],r=t[1]-i[1],n=Math.cos(e),o=Math.sin(e),[n*s-o*r+i[0],o*s+n*r+i[1]]},rotatePoly:function(t,e,i){var n,o,s,r;for(r=[],n=0,o=t.length;n<o;n++)s=t[n],r.push(this.rotatePoint(s,e,i));return r},intersectPoints:function(t,e,i){var n,o,s,r,a,h,d,c,l,u,f,g,p,m;for(1e-9,p=(e=[e[0]+1e-9*Math.cos(i),e[1]+1e-9*Math.sin(i)])[0],m=e[1],f=[p+Math.cos(i),m+Math.sin(i)],h=0,Math.abs(f[0]-p)<1e-9&&(h=1),a=-1,o=t[(l=t.length)-1],d=Number.MAX_VALUE,c=Number.MAX_VALUE,s=null,r=null;++a<l;)n=o,o=t[a],null!=(u=this.lineIntersection(e,f,n,o))&&this.pointInSegmentBox(u,n,o)&&(g=this.squaredDist(e,u),u[h]<e[h]?g<d&&(d=g,s=u):u[h]>e[h]&&g<c&&(c=g,r=u));return[s,r]},findConvexHull:function(){var t,e=[],i=0;if(this.polygon.length>0){for(var n=this.polygon[0],o=1;o<this.polygon.length;o++)this.polygon[o][0]<n[0]&&(n=this.polygon[o]);var s=this.polygon;do{i++,e.push(n),t=s[0];for(var r=1;r<s.length;r++)n!=t&&-1!=this.getOrientation(n,t,s[r])||(t=s[r]);if(i>1e3){console.log("Hull finding is ending to infinity loop!",this.poi);break}n=t}while(e[0]!==t)}return e},getOrientation:function(t,e,i){var n=(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]);return n>0?-1:n<0?1:0},getBounds:function(){return this.bounds},getRotatedAreaBounds:function(){return this.rotatedAreaBounds}}),Renderer2D=Class.extend({init:function(t){this.wayfinder=!1,this.context=!1,this.enabled=!0,this.damaged=!0,this.renderQueue=t},onAdd:function(){},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},damage:function(){this.damaged=!0},undamage:function(){this.damaged=!1},setContext:function(t){this.context=t},setWayfinder:function(t){this.wayfinder=t},render:function(t){}}),FloorRenderer2D=Renderer2D.extend({init:function(){this._super(1),this.lod=0,this.debugPoint=vec2.create(),this.mapImages=[]},setLOD:function(t){this.lod=t},getLOD:function(){return lod},getRequiredTiles:function(t){for(var e=[],i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,o=this.wayfinder.options.mapSize[1]/i,s=0;s<i;s++)for(var r=0;r<i;r++){var a=new Rectangle(s*n,r*o,n,o);t.intersects(a)&&e.push(vec2.fromValues(s,r))}return e},clear:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},renderDefault:function(){var t=this.wayfinder.map.getTransformer(),e=this.wayfinder.map.getCurrentLOD(0,0,0);e&&(this.context.save(),this.clear(),this.context.translate(t.getViewWidth()/2,t.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-t.getViewWidth()/2,-t.getViewHeight()/2),this.context.translate(t.getZoomedMapPosition()[0],t.getZoomedMapPosition()[1]),this.context.scale(t.getZoom(),t.getZoom()),this.context.drawImage(e,0,0),this.context.restore())},renderTile:function(t){if(!1!==t.image){var e=this.wayfinder.map.getTransformer(),i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,o=this.wayfinder.options.mapSize[1]/i;this.context.save(),this.context.translate(e.getViewWidth()/2,e.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-e.getViewWidth()/2,-e.getViewHeight()/2),this.context.translate(e.getZoomedMapPosition()[0],e.getZoomedMapPosition()[1]),this.context.drawImage(t.image,t.x*n*e.getZoom(),t.y*o*e.getZoom(),n*e.getZoom(),o*e.getZoom()),this.context.restore()}},render:function(t){if(this.wayfinder.getCurrentFloor()){var e,i=this.wayfinder.map.getTransformer();if(0!==this.lod&&this.wayfinder.options.enableLOD){var n=[],o=this.getRequiredTiles(t),s=!1;for(e=0;e<o.length;e++){var r=this.wayfinder.map.getCurrentLOD(this.lod,o[e][0],o[e][1]);n.push({x:o[e][0],y:o[e][1],image:r}),!1===r&&(s=!0)}if(s)return this.renderDefault();for(this.clear(),e=0;e<o.length;e++)this.renderTile(n[e])}else this.renderDefault();if(this.wayfinder.options.debugMouseLocation){this.context.save();var a=i.transformPoint(this.debugPoint);this.context.beginPath(),this.context.fillStyle="rgba(255,0,0,0.7)",this.context.arc(a[0],a[1],5,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()}}}}),POIsRenderer2D=Renderer2D.extend({init:function(){this._super(4)},onAdd:function(){this.overlayColor=this.wayfinder.settings.getColor("poi.2d.overlay.color",this.wayfinder.options.overlayHighlightColor),this.drawAlwaysNames=this.wayfinder.settings.getBoolean("poi.2d.display-names-always",!1),this.overlayColorFromGroup=this.wayfinder.settings.getBoolean("poi.2d.overlay-group-color",!1),this.fitToOverlay=this.wayfinder.settings.getBoolean("poi.2d.fit-to-overlay",!1),this.nameColor=this.wayfinder.settings.getColor("poi.2d.name.color","#000000"),this.nameBackgroundColor=this.wayfinder.settings.getColor("poi.2d.name.background-color","#ffffff"),this.nameFontSize=this.wayfinder.settings.getInt("poi.2d.name.font-size",12),this.nameFontFamily=this.wayfinder.settings.get("poi.2d.name.font-family","Arial"),this.displayRoomID=this.wayfinder.settings.get("poi.2d.name.display-room-id",!0),this.fontPadding=this.wayfinder.settings.getInt("poi.2d.name.padding",this.wayfinder.options.poi2DTitlePadding)},render:function(t){var e=this.wayfinder.map.getCurrentFloor();if(e){var i=this.wayfinder.map.getTransformer();this.context.save();for(var n=0;n<e.nodes.length;n++)if(0!==e.nodes[n].pois.length){var o=!1,s=!1,r=i.transformPoint(e.nodes[n].position2d),a=!1;if(r[0]>=0&&r[0]<=i.getViewWidth()&&r[1]>=0&&r[1]<=i.getViewHeight()){for(var h=0;h<e.nodes[n].pois.length;h++){if((a=e.nodes[n].pois[h]).id in this.wayfinder.overlays&&this.isPOIinHighlights(a)){var d=this.wayfinder.overlays[a.id];if(d&&0<d.length){o=!0;for(var c in d)this.renderPOIOverlay(d[c])}}if(a.getAdvertisements().length>0){s=!0;break}a.alwaysVisible||this.isPOIinDisplaying(a)?0!==a.image_id?(this.renderPOIIcon(a,r),o=!0):a.hasName&&(this.renderPOIName(a,r),o=!0):this.drawAlwaysNames&&a.showInMenu&&(this.renderPOIName(a,r),o=!0)}o||a.showInMenu||(this.context.beginPath(),this.context.fillStyle=this.wayfinder.options.poiColor,this.context.arc(r[0],r[1],this.wayfinder.options.poiRadius,0,2*Math.PI,!0),this.context.closePath(),this.context.fill()),this.wayfinder.adImage&&s&&this.context.drawImage(this.wayfinder.adImage,r[0]-1.5*this.wayfinder.options.poiRadius,r[1]-1.5*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius)}}this.context.restore()}},isPOIinHighlights:function(t){for(var e in this.wayfinder.map.highlights)if(this.wayfinder.map.highlights[e]==t)return!0;return!1},isPOIinDisplaying:function(t){for(var e in this.wayfinder.map.displaying)if(this.wayfinder.map.displaying[e]===t)return!0;return!1},renderPOIOverlay:function(t){if(t&&(t.visible||this.isPOIinHighlights(t.poi))&&t.polygon&&t.polygon.length>3){var e=this.wayfinder.map.getTransformer(),i=t.poi,n=null;if(i&&i.getGroups()){var o=i.getGroups()[0];o&&o.getColor()&&(n=o.getColor().toString())}this.overlayColorFromGroup&&n?this.context.fillStyle=n:this.context.fillStyle=this.overlayColor.toString();var s=e.transformPoint(t.polygon[0]);this.context.beginPath(),this.context.moveTo(s[0],s[1]);for(var r=0;r<t.polygon.length;r++)s=e.transformPoint(t.polygon[r]),this.context.lineTo(s[0],s[1]);this.context.closePath(),this.context.fill()}},renderPOIIcon:function(t,e){if(t&&t.getIcon()){var i=this.wayfinder.map.getTransformer(),n=this.wayfinder.overlays[t.id],o=t.getIcon().height/t.getIcon().width,s=(this.context,this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius,t)*i.getZoom()),r=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius,t)*i.getZoom(),a=0;if(n&&0<n.length){var h=n[0].getRotatedAreaBounds();if(h){var d=h.bounds.width*i.getZoom(),c=h.bounds.height*i.getZoom();e=i.transformPoint(h.center),(d<s||c<r)&&(s=c<d?d*(c/s)*.9:.9*d,0!==this.wayfinder.options.map2DRotation&&this.wayfinder.options.map2DRotation<180?a=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(h.angle):this.wayfinder.options.map2DRotation>=180&&(a=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(h.angle)-Math.PI))}}this.isPOIinHighlights(t)&&(s*=1.1);r=s*o;this.context.save(),this.context.rotate(a),e=i.rotatePoint(e,-a),this.context.drawImage(t.getIcon(),e[0]-s/2,e[1]-r/2,Math.round(s),Math.round(r)),this.context.restore()}},renderPOIName:function(t,e){var i=t.getName(this.wayfinder.getLanguage()),n=this.wayfinder.settings.get("poi.2d.name.weight",this.wayfinder.options.poi2DTitleWeight,t);if("string"==typeof i){var o=this.wayfinder.map.getTransformer(),s=Math.floor(this.nameFontSize*o.getZoom());this.context.font=n+" "+s+"px "+this.nameFontFamily,this.context.textAlign="center";var r=this.wayfinder.overlays[t.id],a=this.context.measureText(i).width,h=s,d=0*s,c=this.wayfinder.settings.getInt("poi.text.wrap",-1,t),l=[i.replace("&shy;","")],u=0;if(c>-1){l=this.getLines(i,c),a=0,h=0;for(P=0;P<l.length;P++)a=Math.max(a,this.context.measureText(l[P]).width),h+=s+d}if(this.context.save(),r&&0<r.length){var f=r[0].getRotatedAreaBounds();if(f){var g=Math.abs(f.bounds.width),p=Math.abs(f.bounds.height),m=g*o.getZoom()-this.fontPadding,y=p*o.getZoom()-this.fontPadding;if(a>g&&1.3*g<p&&(0===(u=f.angle)&&(u+=Math.PI/2),m=g*o.getZoom()-this.fontPadding,y=p*o.getZoom()-this.fontPadding),e=o.transformPoint(f.center),m<a){u=f.angle;var v=m/a;s=Math.floor(s*v)}y<h&&(s=Math.floor(y-this.fontPadding)/l.length)}}else s=Math.max(6,Math.floor(s));0!==this.wayfinder.options.map2DRotation&&(u=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(u)),a=0,h=0,this.context.textBaseline="middle",this.context.font=n+" "+s+"px "+this.nameFontFamily;for(var P=0;P<l.length;P++)a=Math.max(a,this.context.measureText(l[P]).width),h+=s+d;metrics=this.context.measureText(i);var I=a+10,w=h+10;this.context.rotate(u),e=o.rotatePoint(e,-u);var A=1==l.length?0:h/2-s/2;if(s>6){this.nameBackgroundColor.a>0&&this.roundedRect(this.context,e[0]-I/2,e[1]-w/2,I,w,5,this.nameBackgroundColor.toString()),this.context.fillStyle=this.nameColor.toString();for(var b=0;b<l.length;b++)this.context.fillText(l[b],e[0],e[1]-A),A-=s+d}this.context.restore()}},measureText:function(){},roundedRect:function(t,e,i,n,o,s,r){t.beginPath(),t.moveTo(e,i+s),t.lineTo(e,i+o-s),t.quadraticCurveTo(e,i+o,e+s,i+o),t.lineTo(e+n-s,i+o),t.quadraticCurveTo(e+n,i+o,e+n,i+o-s),t.lineTo(e+n,i+s),t.quadraticCurveTo(e+n,i,e+n-s,i),t.lineTo(e+s,i),t.quadraticCurveTo(e,i,e,i+s),t.fillStyle=r,t.fill()},renderRotatedAreaBounds:function(t,e,i,n){var o=this.wayfinder.map.getTransformer(),s=o.transformPoint(e[0]),r=vec2.add(vec2.create(),s,e[1]);vec2.scale(r,r,o.getZoom());var a=o.transformPoint(e[1]);o.transformPoint(e[0]),o.transformPoint(e[1]);this.context.beginPath(),this.context.fillStyle="rgba(255, 0, 0, 1.0)",this.context.arc(s[0],s[1],5*o.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 255, 0, 1.0)",this.context.arc(r[0],r[1],3*o.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 255, 1.0)",this.context.arc(a[0],a[1],3*o.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},calcNiceAngle:function(t,e){t>Math.PI/2&&(t=Math.PI-t);var i=t/(Math.PI/2),n=Math.round(i)-i;return Math.abs(n)<.27&&(t=Math.round(i)*(Math.PI/2)),t},nearPI:function(t){var e=t/(Math.PI/2),i=Math.round(e)-e;return Math.abs(i)<.27},getBoundsMidPoint:function(t){var e=vec2.sub(vec2.create(),t[1],t[0]);vec2.scale(e,e,.5);var i=vec2.fromValues(-e[1],e[0]);vec2.normalize(i,i),vec2.scale(i,i,t[2]/2);var n=vec2.add(vec2.create(),t[0],e);return vec2.sub(n,n,i),n},getPOILocationOnMap:function(t){var e=this.wayfinder.map.getTransformer(),i=vec2.scale(vec2.create(),e.transformPoint(t.getNode().position2d),1/e.getViewScale());return i[0]>=0&&i[0]<=e.getViewWidth()&&i[1]>=0&&i[1]<=e.getViewHeight()&&i},getPOIOverlayLocationOnMap:function(t){var e=this.wayfinder.overlays[t.id];if(e&&e.length>0){e=e[0];var i=this.wayfinder.map.getTransformer(),n=vec2.scale(vec2.create(),i.transformPoint(vec2.fromValues(e.bounds[0]+e.bounds[2]/2,e.bounds[1]+e.bounds[3]/2)),1/i.getViewScale());return n[0]>=0&&n[0]<=i.getViewWidth()&&n[1]>=0&&n[1]<=i.getViewHeight()?n:this.getPOILocationOnMap(t)}return this.getPOILocationOnMap(t)},renderPolygon:function(t,e,i){var n=this.wayfinder.map.getTransformer(),o=n.transformPoint(vec2.fromValues(t[0][0],t[0][1]));this.context.fillStyle=e,this.context.beginPath(),i&&(o=n.rotatePoint(o,i)),this.context.moveTo(o[0],o[1]);for(var s=0;s<t.length;s++)o=n.transformPoint(vec2.set(o,t[s][0],t[s][1])),i&&(o=n.rotatePoint(o,i)),this.context.lineTo(o[0],o[1]);this.context.closePath(),this.context.fill()},drawRectangle:function(t,e,i,n,o,s){var r=this.wayfinder.map.getTransformer();e=r.transformPoint(e),o||(o=0),i*=r.getZoom(),n*=r.getZoom(),t.save(),t.strokeStyle=s,t.translate(e[0],e[1]),t.rotate(o),t.rect(0,0,i,n),t.stroke(),t.restore()},drawPoint:function(t,e,i){var n=this.wayfinder.map.getTransformer();this.context.beginPath(),this.context.fillStyle=i,this.context.arc(t[0],t[1],e*n.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},getLines:function(t,e){var i=t.replace(/\&shy;/g," &shy; ").split(" "),n=t.replace("&shy;","-").length,o=[],s=i[0];if(e<=0)return i;if(i.length<=e)return i;for(var r=1;r<i.length;r++)"&shy;"!==i[r].toLowerCase()?s.length>n/e?(o.push(s),s=i[r]):s+=" "+i[r]:s.length+1>n/e?(o.push(s+"-"),s=""):r+1<i.length&&(o.push(s+i[++r]),s="");return""!==s&&o.push(s),o}}),PathRenderer2D=Renderer2D.extend({init:function(){this._super(3),this.spots=[],this.position=0,this.timer=!1,this.animating=!1,this.paused=!1,this.msgOffset=vec2.fromValues(0,10),this.message="",this.messagePosition=vec2.fromValues(0,0)},onAdd:function(){this.spotColor=this.wayfinder.settings.getColor("path.2d.color","rgba(255,0,0,0.8)"),this.pathPauseTime=this.wayfinder.settings.getInt("path.2d.pause-time",this.wayfinder.options.pathPauseTime),this.messageSize=this.wayfinder.settings.getInt("path.2d.message-size",this.wayfinder.options.path2DMessageSize),this.spotSize=this.wayfinder.settings.getFloat("path.2d.size",this.wayfinder.options.pathSpotRadius),this.pathSpeed=this.wayfinder.settings.getFloat("path.2d.speed",this.wayfinder.options.pathSpeed),this.pathStride=this.wayfinder.settings.getFloat("path.2d.stride",this.wayfinder.options.pathStride),this.spotSize<.1&&(this.spotSize=.1),this.pathSpeed<.05&&(this.pathSpeed=.05),this.pathStride<.05&&(this.pathStride=.05)},reset:function(){this.position=0},generatePath:function(t){this.spots=[];for(var e,i,n,o,s,r=0,a=this.pathStride,h=1,d=t.nodes.length;h<d;h++)if(i=t.nodes[h-1],n=t.nodes[h],o=vec2.normalize(vec2.create(),vec2.subtract(vec2.create(),n.position2d,i.position2d)),s=vec2.distance(i.position2d,n.position2d),"portal"===i.type&&"portal"===n.type)this.spots.push({floor:i.floor,position:i.position2d,node:i});else for(var c=r;c<s;c+=a)e={floor:i.floor,position:vec2.add(vec2.create(),i.position2d,vec2.scale(vec2.create(),o,c))},c+a>s&&(r=a-(s-c),e.node=t.nodes[h]),this.spots.push(e)},setPath:function(t,e){if(t instanceof Path2D&&!t.isEmpty()){!1!==this.timer&&(clearTimeout(this.timer),this.timer=!1),this.position=0,this.generatePath(t),vec2.set(this.messagePosition,0,0);var i=this;this.animating=!0;var n=function(){i.paused=!1;var t=i.spots[i.position];i.renderSpot(i.position),i.position++;var o=i.spots[i.position];if(t&&t.node&&i.wayfinder.cbOnPathStep(t),i.position===i.spots.length)return i.animating=!1,void(e&&"function"==typeof e&&e());var s=0;if(o&&t.floor.id!==o.floor.id){var r=function(t,e){for(var i=0,n=e+1,o=t.length;n<o;n++)if(t[n].floor.id==t[n-1].floor.id){if(2==++i)return t[n].floor}else i=0;return!1}(i.spots,i.position+1);if(s=i.pathPauseTime,r&&i.wayfinder.options.pathDisplayInstructions){i.messagePosition=i.wayfinder.map.getTransformer().transformPoint(vec2.add(i.messagePosition,t.position,i.msgOffset));var a=i.wayfinder.getLanguage();i.message=i.wayfinder.translator.get("go_to_floor",[i.wayfinder.map.getCurrentFloor().getName(a),r.getName(a)]),i.renderMessage(i.messagePosition,i.message),i.paused=!0}}else i.position>1&&i.spots[i.position-2].floor.id!==t.floor.id&&(i.wayfinder.showFloor(t.floor),i.wayfinder.map.renderer.damageAll(),i.wayfinder.map.renderer.render());i.timer=setTimeout(n,i.pathSpeed+s)};this.paused||(this.timer=setTimeout(n,this.wayfinder.options.pathSpeed)),"function"!=typeof this.wayfinder.cbOnPathStart||t.isEmpty()||this.wayfinder.cbOnPathStart(t.nodes[t.nodes.length-1])}},updatePath:function(t){this.animating||(this.generatePath(t),this.position=this.spots.length)},clearPath:function(){this.position=0,this.spots=[],clearTimeout(this.timer)},renderMessage:function(t,e){var i=this.wayfinder.map.getTransformer();this.context.save(),this.context.font="bold "+this.messageSize*i.getViewScale()+"px sans-serif",this.context.textBaseline="top",this.context.textAlign="center",this.context.fillStyle="rgba(40, 40, 40, 0.75)";var n=this.context.measureText(e).width;this.context.fillRect(t[0]-(n+20)/2,t[1],n+20,this.messageSize*i.getViewScale()+20),this.context.fillStyle="rgba(255,255,255,1.0)",this.context.fillText(e,t[0],t[1]+10),this.context.restore()},renderSpot:function(t){var e=this.wayfinder.map.getTransformer();if(this.spots[t]){this.context.save();var i=e.transformPoint(this.spots[t].position);this.context.beginPath(),this.context.fillStyle=this.spotColor.toString(),this.context.arc(i[0],i[1],this.spotSize*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()}},render:function(t){if(0!==this.spots.length){var e=this.wayfinder.map.getCurrentFloor();this.context.save();for(var i=0,n=this.position;i<n;i++)this.spots[i].floor.id===e.id&&this.renderSpot(i);this.paused&&this.renderMessage(this.messagePosition,this.message),this.context.restore()}}}),NodesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(t){var e=this.wayfinder.map.getTransformer(),i=this.wayfinder.map.getCurrentFloor();if(i){this.context.save();for(var n in i.nodes){var o=e.transformPoint(i.nodes[n].position2d);this.context.beginPath(),this.context.fillStyle="rgba(60,120,0,0.7)",this.context.arc(o[0],o[1],2,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.fillText(i.nodes[n].id,o[0]+2,o[1]+2)}this.context.restore()}}}),EdgesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(t){var e=this.wayfinder.map.getTransformer(),i=this.wayfinder.map.getCurrentFloor();if(i){this.context.save();for(var n in i.nodes){var o=e.transformPoint(i.nodes[n].position2d);for(var s in i.nodes[n].neighbours){var r=e.transformPoint(i.nodes[n].neighbours[s].position2d);this.context.lineWidth=1,this.context.strokeStyle="rgba(10,10,10,0.1)",this.context.beginPath(),this.context.moveTo(o[0],o[1]),this.context.lineTo(r[0],r[1]),this.context.closePath(),this.context.stroke()}}this.context.restore()}}}),ExtrasRenderer2D=Renderer2D.extend({init:function(){this._super(5),this.yahSize=30},onAdd:function(){this.yahSize=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius)},render:function(t){var e=this.wayfinder.map.getTransformer();if(this.context.save(),this.yahImage="",this.wayfinder.options.enableUserLocation&&"function"==typeof this.wayfinder.getCurrentPosition&&this.wayfinder.getCurrentPosition()){var i=this.wayfinder.getCurrentPosition(),n=e.transformPoint(i.location);this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 200, 0.5)",this.context.arc(n[0],n[1],5*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill();this.context.fill()}if(this.wayfinder.yahImage&&this.wayfinder.options.drawKioskIcon&&!1!==this.wayfinder.getKioskNode()&&this.wayfinder.getKioskNode().floor.id==this.wayfinder.getCurrentFloor().id){var o=this.wayfinder.yahImage,s=e.transformPoint(this.wayfinder.getKioskNode().position2d),r=this.yahSize*e.getZoom(),a=r/o.width*o.height;0===this.wayfinder.options.yahRotation?this.context.drawImage(o,s[0]-r/2,s[1]-a,r,a):(this.context.save(),this.context.translate(s[0],s[1]),this.context.rotate(this.wayfinder.options.yahRotation*Math.PI/180),this.context.drawImage(o,-r/2,-a/2,r,a),this.context.restore())}this.context.restore()}}),DebugRenderer2D=Renderer2D.extend({init:function(){this._super(5),this.yahSize=30},onAdd:function(){this.debugBeacons=this.wayfinder.options.debugBeacons},render:function(t){var e=this.wayfinder.map.getTransformer();if(this.context.save(),this.debugBeacons&&this.wayfinder.mobileLogic){var i,n,o,s=this.wayfinder.mobileLogic.mobileData.ibeacons,r=this.wayfinder.mobileLogic.device.locationManager?this.wayfinder.mobileLogic.device.locationManager.locator.foundBeacons:{};for(var a in s)if(o=s[a],(i=this.wayfinder.nodes[parseInt(o.node_id)])&&this.wayfinder.map.getCurrentFloor().id===i.floor.id&&(n=e.transformPoint(i.position2d),i.position2d)){this.context.beginPath(),r[parseInt(i.id)]?this.context.fillStyle="rgba(0, 200, 0, 0.9)":this.context.fillStyle="rgba(0, 0, 200, 0.9)",this.context.arc(n[0],n[1],8*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.font=7*e.getZoom()+"px Arial";i.id.split(".");this.context.fillStyle="white",this.context.fillText(o.major+"."+o.minor,n[0]-7*e.getZoom(),n[1]+2*e.getZoom())}}this.context.restore()}}),Wayfinder2DRendering=Class.extend({init:function(t,e){this.wayfinder=t,this.context=null,this.renderers=[],e&&(this.context=e.getContext("2d"))},damageAll:function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].damage()},render:function(){for(var t=this.wayfinder.map.getTransformer(),e=new Rectangle(t.getX(),t.getY(),t.getUnzoomedViewWidth(),t.getUnzoomedViewHeight()),i=0;i<this.renderers.length;i++)this.renderers[i]&&this.renderers[i].enabled&&this.renderers[i].damaged&&(this.renderers[i].render(e),this.renderers[i].undamage(),!0)},add:function(t){if(!(t instanceof Renderer2D))return!1;t.setContext(this.context),t.setWayfinder(this.wayfinder);for(var e=0;e<this.renderers.length;e++)if(t.renderQueue<this.renderers[e].renderQueue)return this.renderers.splice(e,0,t),t.onAdd(),!0;return this.renderers.push(t),t.onAdd(),!0},updateRenderers:function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].setContext(this.context)}}),Map2D=Class.extend({init:function(t){this.wayfinder=t,this.highlights=[],this.displaying=[],this.LODImages=[],this.onUpdateCallback=null,this.renderAll=!1,this.renderOnlyBase=!1,this.renderCycle=null,this.renderInterval=22,this.wayfinder.padding=0,this.mapClickAll=this.wayfinder.settings.getBoolean("poi.2d.map-click-all",!1),this.onPOIClick=!1,this.renderer,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate)},setup:function(){this.renderer=new Wayfinder2DRendering(this.wayfinder,this.wayfinder.logic.getCanvas()),this.mapMover=new Map2DMover(this.wayfinder.logic.getCanvas(),this.wayfinder.options,ClassCallback(this,this.update)),this.mapMover.cbOnClick=ClassCallback(this,this.onClick),this.mapMover.cbOnLongClick=ClassCallback(this,this.onLongClick),this.pathRenderer=new PathRenderer2D,this.floorRenderer=new FloorRenderer2D,this.poisRenderer=new POIsRenderer2D,this.extrasRenderer=new ExtrasRenderer2D,this.wayfinder.options.debug&&(this.debugRenderer=new DebugRenderer2D),this.addRenderers()},updateCanvas:function(t){this.renderer.context=t.getContext("2d"),this.renderer.updateRenderers(),this.mapMover.view=t,this.mapMover.bindEvents()},start:function(){var t=this;this.renderAll=!0;var e=function(){t.renderAll?(t.renderer.damageAll(),t.renderer.render(),t.renderAll=!1,t.renderOnlyBase=!1):t.renderOnlyBase&&(t.floorRenderer.damage(),t.renderer.render(),t.renderOnlyBase=!1),t.renderCycle=requestAnimFrame(e,this.renderInterval)};this.renderCycle=requestAnimFrame(e,this.renderInterval)},addLODImage:function(t,e,i,n,o){this.LODImages&&(this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]),this.LODImages[t][e][i]||(this.LODImages[t][e][i]=[]),this.LODImages[t][e][i][n]||(this.LODImages[t][e][i][n]=[]),this.LODImages[t][e][i][n]=o)},getLODImage:function(t,e,i,n){return!!(this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e][i]&&this.LODImages[t][e][i][n])&&this.LODImages[t][e][i][n]},getContainerNeededLevel:function(){var t=Math.max(this.getTransformer().getZoomedMapWidth(),this.getTransformer().getZoomedMapHeight()),e=Math.floor(t/this.wayfinder.options.mapSize[0]);return Math.min(e,this.wayfinder.options.maxLOD)},getMaxLODLevel:function(t){var e=0;if(this.LODImages[t]){for(var i=0;i<=this.wayfinder.options.maxLOD;i++)this.LODImages[t][i]&&this.LODImages[t][i].length==Math.pow(2,i)&&this.imagesInLevel(t,i)==Math.pow(4,i)&&(e=i);e=Math.max(0,Math.min(e,this.wayfinder.options.maxLOD))}return e},imagesInLevel:function(t,e){var i=0;if(this.LODImages[t]&&this.LODImages[t][e])for(var n in this.LODImages[t][e])this.LODImages[t][e][n]&&(i+=this.LODImages[t][e][n].length);return i},addRenderers:function(){this.renderer.add(this.floorRenderer),this.renderer.add(this.poisRenderer),this.renderer.add(this.pathRenderer),this.renderer.add(this.pathRenderer),this.renderer.add(this.extrasRenderer),this.renderer.add(this.debugRenderer)},onPositionUpdate:function(){var t=this.wayfinder.geolocation.currentPosition,e=this.wayfinder.geolocation.currentGeoPosition;console.log("=== Position Update ==="),console.log("Geo.pos: ("+e[0]+", "+e[1]+")",e),console.log("Map.pos: ("+t[0]+", "+t[1]+")",t);var i;!1!==(i=void 0===t[0]?this.findNearestNodeOnFloor(this.getCurrentFloor(),vec2.fromValues(t.x,t.y)):this.findNearestNodeOnFloor(this.getCurrentFloor(),t))&&(this.wayfinder.kiosk=i),this.update(!0)},onClick:function(t){var e=this.getCurrentFloor();if(e){var i=t,n=[];this.wayfinder.options.debugMouseLocation&&(this.floorRenderer.debugPoint=i);for(var o in e.nodes)if("object"==typeof e.nodes[o]&&0!==e.nodes[o].pois.length)for(var s=0;s<e.nodes[o].pois.length;s++){var r=e.nodes[o].pois[s];if(this.wayfinder.overlays[r.id])for(var a in this.wayfinder.overlays[r.id])"object"!=typeof this.wayfinder.overlays[r.id][a]||!this.wayfinder.overlays[r.id][a].contains(i)||(n.push(r),this.mapClickAll);!(vec2.distance(i,e.nodes[o].position2d)<this.wayfinder.options.poiRadius)||(n.push(r),this.mapClickAll)}if(n.length>0){var h=vec2.scale(vec2.create(),t,1/this.getTransformer().getViewScale());this.openPOI(n[0],h),this.wayfinder.events.trigger("map-click",n,h)}}},openPOI:function(t,e){this.clearHighlights(),this.clearDisplaying(),this.wayfinder.settings.getBoolean("poi.highlight",!0,t)&&this.highlights.push(t),this.wayfinder.settings.getBoolean("poi.display",!0,t)&&this.displaying.push(t),this.pathRenderer.clearPath(),this.update(!0),this.onPOIClick&&"function"==typeof this.onPOIClick&&this.onPOIClick(t,e)},onLongClick:function(t){if(this.wayfinder.options.enableUserYAHSetting){var e=this.getTransformer().inverseTransformPoint(t),i=this.findNearestNodeOnFloor(this.getCurrentFloor(),e);!1!==i&&(this.wayfinder.kiosk=i,this.update(!0))}},update:function(t){this.wayfinder.paused||(this.wayfinder.options.enableLOD&&this.checkLODLevels(),t||!0===this.wayfinder.options.forceFullMapUpdate?this.renderAll=!0:this.renderOnlyBase=!0,"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate(t))},resize:function(t,e,i,n){if(t.setAttribute("width",e+"px"),t.setAttribute("height",i+"px"),this.getTransformer()){var o=this.getTransformer();o.setViewSize(vec2.fromValues(e,i)),o.setViewScale(n),o.setZoom(0),this.update(!0)}},getTransformer:function(){return!!this.mapMover&&this.mapMover.mapTransformer},getCurrentFloor:function(){return this.wayfinder.getCurrentFloor()},fitPathInView:function(t){if(!1!==t){var e=t.getBounds(),i=this.getTransformer(),n=vec2.fromValues(this.wayfinder.padding,this.wayfinder.padding),o=vec2.add(vec2.create(),e.size,n),s=-1;e.size[0]>e.size[1]?((s=i.getViewWidth()/o[0])<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(s):((s=i.getViewHeight()/o[1])<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(s),i.setPosition(e.min[0]-(i.getUnzoomedViewWidth()/2-e.size[0]/2),e.min[1]-(i.getUnzoomedViewHeight()/2-e.size[1]/2))}},fitPOIInView:function(t){if(!1!==t){var e=this.wayfinder.overlays[t.id],i=[0,0,0,0];i=e&&e.length>0?e[0].getBounds():[t.getNode().position2d[0],t.getNode().position2d[1],1,1];var n=this.getTransformer(),o=[Math.max(i[0]-this.wayfinder.padding,0),Math.max(i[1]-this.wayfinder.padding,0),Math.min(i[2]+2*this.wayfinder.padding,n.getMapWidth()),Math.min(i[3]+2*this.wayfinder.padding,n.getMapHeight())];i[2]>i[3]?n.setZoom(Math.min(n.getZoom(),n.getViewWidth()/o[2])):n.setZoom(Math.min(n.getZoom(),n.getViewHeight()/o[3]));var s=n.getPosition(),r=0,a=0;r=Math.min(0,o[0]-s[0]),a=Math.min(0,o[1]-s[1]),r=Math.max(r,o[0]+o[2]-s[0]-n.getViewWidth()),a=Math.max(a,o[1]+o[3]-s[1]-n.getViewHeight()),n.setPosition(s[0]+r,s[1]+a)}},fitMultiplePOIsInView:function(t){if(!1!==t){var e=!1,i=1024,n=1024,o=0,s=0;this.wayfinder.kiosk&&(o=this.wayfinder.kiosk.position2d[0],s=this.wayfinder.kiosk.position2d[1]);for(var r=!1,a=0;a<t.length;a++)(e=t[a])&&e.getNode()&&((r=this.wayfinder.overlays[e.id])&&r.length>0&&r[0].getBounds()?(i=Math.min(i,r[0].getBounds()[0]),n=Math.min(n,r[0].getBounds()[1]),o=Math.max(o,r[0].getBounds()[0]+r[0].getBounds()[2]),s=Math.max(s,r[0].getBounds()[1]+r[0].getBounds()[3])):e.getNode().position2d&&(i=Math.min(i,e.getNode().position2d[0]),n=Math.min(n,e.getNode().position2d[1]),o=Math.max(o,e.getNode().position2d[0]),s=Math.max(s,e.getNode().position2d[1])));var h=[i,n,o-i,s-n],d=this.getTransformer();h[0]=Math.max(1,h[0]-this.wayfinder.padding),h[1]=Math.max(1,h[1]-this.wayfinder.padding),h[2]=Math.min(d.mapSize[0],h[2]+2*this.wayfinder.padding),h[3]=Math.min(d.mapSize[1],h[3]+2*this.wayfinder.padding);var c=d.getViewWidth()/h[2];c=Math.min(c,d.getViewHeight()/h[3]),d.setZoom(c),d.setPosition(h[0]-(d.getUnzoomedViewWidth()/2-h[2]/2),h[1]-(d.getUnzoomedViewHeight()/2-h[3]/2))}},checkLODLevels:function(){if(this.getCurrentFloor()){var t=this.getCurrentFloor().id,e=this.getMaxLODLevel(t),i=this.getContainerNeededLevel(),n=this.isLODLoading(t,i);this.isLODLoaded(t,i)?this.floorRenderer.setLOD(i):this.floorRenderer.setLOD(e),n||this.preloadNextLODLevel(t,i)}},isLODLoading:function(t,e){return!(!this.LODImages[t]||!this.LODImages[t][e])},isLODLoaded:function(t,e){return!!(this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e]&&this.LODImages[t][e].length==Math.pow(2,e)&&this.imagesInLevel(t,e)==Math.pow(4,e))},getCurrentLOD:function(t,e,i){if(t>-1){var n=this.getLODImage(this.getCurrentFloor().id,t,e,i);if(n)return n}return!1},preloadNextLODLevel:function(t,e){if(t&&e<this.wayfinder.options.maxLOD){var i=this,n=Math.pow(2,e);this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]);for(var o={},s=0;s<n;s++)for(var r=0;r<n;r++)o[t+"_"+e+"_"+s+"_"+r]={url:WayfinderAPI.getURL("2d","lod",[t,e,s,r]),type:"image"};Logistics.getMultiple(o,function(n){var o=[];for(var s in n)o=s.split("_"),i.addLODImage(o[0],o[1],o[2],o[3],n[s]);i.afterPreload(t,e)})}},afterPreload:function(t,e){this.update(!0)},setHighlights:function(t){for(var e in t)this.highlights.push(t[e])},clearHighlights:function(){this.highlights=[]},setDisplaying:function(t){for(var e in t)this.displaying.push(t[e])},clearDisplaying:function(){this.displaying=[]},findNearestNodeOnFloor:function(t,e,i){if(!(t instanceof Floor))return!1;var n,o=1/0,s=!1;for(var r in t.nodes)if(!(n=t.nodes[r]).neighbours||n.neighbours.length>0){var a=vec2.distance(e,n.position2d);a<o&&(s=n,o=a)}return s},setZoom:function(t){this.getTransformer().setZoomPercentage(t)},zoomIn:function(){this.mapMover.mapTransformer.zoomIn()},zoomOut:function(){this.mapMover.mapTransformer.zoomOut()},redraw:function(){this.renderer&&(this.renderer.damageAll(),this.renderer.render())},getPOILocationOnMap:function(t){return this.poisRenderer.getPOILocationOnMap(t)},getPOIOverlayLocationOnMap:function(t){return this.poisRenderer.getPOIOverlayLocationOnMap(t)},onMapUpdate:function(){"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate()}}),Map2DFallback=Map2D.extend({init:function(t){this.wayfinder=!1,t instanceof Wayfinder&&(this.wayfinder=t),this.currentFloorID=0,this.highlights=new Array,this.LODImages=new Array,this.onPOIClick=!1,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate),this.map=$("<div id='"+this.wayfinder.options.map+"_fallback''></div>"),$("#"+this.wayfinder.options.map).parent().append(this.map),this.map.text("Your browser does not support this application. Please upgrade your browser.")},update:function(){if(this.currentFloorID>0){var t=this.getCurrentLOD(this.currentFloorID,0,0);log(this.currentFloorID,t),t&&this.map.append(t)}},fitPathInView:function(){},fitMultiplePOIsInView:function(){},resize:function(t,e){},zoomIn:function(){},zoomOut:function(){},addRenderers:function(){},redraw:function(){}}),Map2DMover=Class.extend({init:function(t,e,i){this.view=t,this.options=e,this.cbUpdate=i,this.cbOnClick=!1,this.cbOnLongClick=!1,this.mouseDelta=vec2.create(),this.mouseDown=!1,this.mouseDelta=vec2.create(),this.smoothPanning=!0,this.dragTimeout=null,this.panInterval=10,this.panSensitivity=.3,this.lastPinch=0,this.rendering=!1,this.lastDraw=-1,this.waitForFullRedraw=300,this.fullRedrawTimer=null,this._dragVec=vec2.create(),this.zeroVec=vec2.create(),this.setup()},setup:function(){this.mapTransformer=new Map2DTransformer(vec2.fromValues(this.options.mapSize[0],this.options.mapSize[1]),vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),!0,this.options),this.options.disableMap2DMovement||this.bindEvents()},bindEvents:function(){Hammer(this.view).on("pinch",ClassCallback(this,this.onPinch)),Hammer(this.view).on("hold",ClassCallback(this,this.onHold)),Hammer(this.view).on("tap",ClassCallback(this,this.onTap)),Hammer(this.view).on("release",ClassCallback(this,this.stop)),Hammer(this.view).on("drag",ClassCallback(this,this.onDrag)),Hammer(this.view).on("dragend",ClassCallback(this,this.onEndDrag)),Hammer(this.view).on("dragstart",ClassCallback(this,this.onStartDrag)),this.bindMouseWheel(ClassCallback(this,this.onWheel))},stop:function(t){this.cbUpdate(!0),this.lastPinch=0,this.mouseDelta=vec2.create()},getRelativeMousePosition:function(t){var e=this.view.getBoundingClientRect().left+document.body.scrollLeft,i=this.view.getBoundingClientRect().top+document.body.scrollTop,n=vec2.sub(vec2.create(),t,vec2.fromValues(e,i));return n=this.mapTransformer.inverseTransformPoint(n)},bindMouseWheel:function(t){this.view.addEventListener?(this.view.addEventListener("mousewheel",t,!1),this.view.addEventListener("DOMMouseScroll",t,!1)):this.view.attachEvent("onmousewheel",t)},onStartDrag:function(t){this.stop(),this.mouseDelta=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY)},onDrag:function(t){if(t.gesture.preventDefault(),!this.rendering&&"drag"==t.type){var e=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY);vec2.scale(e,e,this.mapTransformer.getViewScale());var i=vec2.sub(this._dragVec,this.mouseDelta,e);this.pan(i,!1),this.mouseDelta=e}},pan:function(t,e){if(this.rendering=!0,void 0===e&&(e=!0),0!==this.options.map2DRotation){var i=vec2.len(t);t=this.mapTransformer.rotatePointAroundCenter(t,this.zeroVec,-this.options.map2DRotation),vec2.normalize(t,t),vec2.scale(t,t,i)}this.mapTransformer.move(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&(this.cbUpdate(e),this.lastDraw=(new Date).getTime()),null===this.fullRedrawTimer&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw)),this.rendering=!1},checkFullDraw:function(){var t=(new Date).getTime();this.lastDraw>0&&t-this.lastDraw>this.waitForFullRedraw?("function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.fullRedrawTimer=null,this.lastDraw=-1):-1!==this.lastDraw&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw))},onEndDrag:function(t){if(void 0!==t&&"dragend"===t.type&&t.gesture){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout);var e=vec2.fromValues(t.gesture.velocityX,t.gesture.velocityY);if(this.smoothPanning&&vec2.sqrLen(e)>.3){var i=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY),n=vec2.create();vec2.multiply(n,i,e);var o=this,s=function(){var t=vec2.create();vec2.div(t,n,vec2.fromValues(13,13)),vec2.sub(n,n,t);if(vec2.sqrLen(t)>3){if(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(s,o.panInterval),!this.rendering){var e=vec2.negate(vec2.create(),t);o.pan(e,!1)}}else o.pan(vec2.create(),!0),o.lastDraw=-1};this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(s,this.panInterval)}this.pan(vec2.create(),!0),this.lastDraw=-1}},onHold:function(t){this.cbOnLongClick&&"function"==typeof this.cbOnLongClick&&this.cbOnLongClick(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY))},onTap:function(t){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout),this.cbOnClick&&"function"==typeof this.cbOnClick&&this.cbOnClick(this.getRelativeMousePosition(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY)))},onWheel:function(t){(t=window.event||t).preventDefault?t.preventDefault():t.returnValue=!1;var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),i=function(t){return t<0?-1:t>0?1:0},n=0;if(void 0!==e?n=i(e):void 0!==t.detail&&(n=-i(t.detail)),n>0)this.mapTransformer.zoomIn();else{if(!(n<0))return;this.mapTransformer.zoomOut()}this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onPinch:function(t){if(t.gesture.preventDefault(),!this.rendering&&t.gesture){0===this.lastPinch&&(this.lastPinch=this.mapTransformer.getZoom());var e=this.lastPinch*t.gesture.scale;this.pinch(e)}},pinch:function(t){this.rendering=!0,0!==t&&(this.mapTransformer.setZoom(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)),this.rendering=!1},onDoubleTap:function(t){var e=t.gesture.center,i=(this.mapTransformer.getZoom(),this.mapTransformer.getZoomStep(),vec2.create());vec2.sub(i,vec2.fromValues(e.pageX,e.pageY),vec2.fromValues(this.view.getBoundingClientRect().left,this.view.getBoundingClientRect().top));var n=this.mapTransformer.inverseTransformPoint(e.pageX,e.pageY);this.mapTransformer.setPosition(n.x,n.y),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onZoomInPressed:function(t){this.mapTransformer.zoomIn(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomInPressed),this.zoomInterval)},onZoomOutPressed:function(t){this.mapTransformer.zoomOut(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomOutPressed),this.zoomInterval)},onZoomEnd:function(){!1!==this.zoomTimer&&(clearTimeout(this.zoomTimer),this.zoomTimer=!1),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},viewScale:function(){var t=vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),e=window,i=document,n=i.documentElement,o=i.getElementsByTagName("body")[0],s=e.innerWidth||n.clientWidth||o.clientWidth,r=e.innerHeight||n.clientHeight||o.clientHeight,a=vec2.fromValues(s,r);return vec2.sqrLen(t)/vec2.sqrLen(a)}}),Map2DTransformer=Class.extend({init:function(t,e,i,n){this.position=vec2.create(),this.zoom=1,this.options=n,this.mapSize=t,this.viewSize=e,this.viewScale=1,this.zoomRange=vec2.fromValues(.1,3*this.viewScale),this.zoomSteps=30,this.centering=void 0===i||i,this.padding=void 0!==this.options.pathZoomPadding?this.options.pathZoomPadding:0,this.centerIfZoomedOut(),this.cbOnZoomChange=null},getPosition:function(){return this.position},getViewSize:function(){return this.viewSize},getViewScale:function(){return this.viewScale},getMapPosition:function(){return vec2.negate(vec2.create(),this.position)},getZoomedMapPosition:function(){return vec2.negate(vec2.create(),this.getZoomedPosition())},getZoomedPosition:function(){return vec2.scale(vec2.create(),this.position,this.zoom)},getX:function(){return this.position[0]},getY:function(){return this.position[1]},getZoomedX:function(){return this.position[0]*this.zoom},getZoomedY:function(){return this.position[1]*this.zoom},getZoom:function(){return this.zoom},getZoomRange:function(){return this.zoomRange},getZoomStep:function(){return(this.zoomRange[1]*this.viewScale-this.zoomRange[0])/this.zoomSteps},setPosition:function(t,e){this.position[0]=t,this.position[1]=e,this.position[0]=Math.min(this.position[0],this.getMapWidth()-this.getUnzoomedViewWidth()),this.position[1]=Math.min(this.position[1],this.getMapHeight()-this.getUnzoomedViewHeight()),this.position[0]=Math.max(this.position[0],0),this.position[1]=Math.max(this.position[1],0),this.centerIfZoomedOut()},setZoomedPosition:function(t,e){this.setPosition(t/this.getZoom(),e/this.getZoom())},move:function(t){this.setPosition(this.position[0]+t[0]/this.getZoom(),this.position[1]+t[1]/this.getZoom())},setViewSize:function(t){this.viewSize=t;var e=Math.min(this.viewSize[0],this.viewSize[1]),i=Math.max(this.viewSize[0],this.viewSize[1]);this.zoomRange[0]=e/this.mapSize[0],this.zoomRange[1]=Math.max(this.options.maxLOD,this.mapSize[0]*this.options.maxLOD/i)},setViewScale:function(t){this.viewScale=t},setZoom:function(t){var e=this.getUnzoomedViewWidth(),i=this.getUnzoomedViewHeight();this.zoom=t,this.zoom<this.zoomRange[0]&&(this.zoom=this.zoomRange[0]),this.zoom>this.zoomRange[1]*this.viewScale&&(this.zoom=this.zoomRange[1]*this.viewScale);var n=this.getUnzoomedViewWidth()-e,o=this.getUnzoomedViewHeight()-i;if(this.setPosition(this.getX()-n/2,this.getY()-o/2),this.centerIfZoomedOut(),"function"==typeof this.cbOnZoomChange){var s=(this.zoomRange[1]-this.zoom)/(this.zoomRange[1]-this.zoomRange[0]);this.cbOnZoomChange(s)}},setZoomPercentage:function(t){var e=this.zoomRange[1]-(this.zoomRange[1]-this.zoomRange[0])*(1-t);this.setZoom(e)},centerIfZoomedOut:function(){this.centering&&(this.getUnzoomedViewWidth()>=this.getMapWidth()&&(this.position[0]=-(this.getUnzoomedViewWidth()-this.getMapWidth())/2),this.getUnzoomedViewHeight()>=this.getMapHeight()&&(this.position[1]=-(this.getUnzoomedViewHeight()-this.getMapHeight())/2))},zoomIn:function(){this.setZoom(this.getZoom()+this.getZoomStep())},zoomOut:function(){this.setZoom(this.getZoom()-this.getZoomStep())},zoomToFit:function(){this.mapSize[0]>this.mapSize[1]?this.zoom=this.viewSize[0]/this.mapSize[0]:this.zoom=this.viewSize[1]/this.mapSize[1],this.getZoomedMapHeight()>this.getViewHeight()&&(this.zoom=Math.min(this.viewSize[0],this.viewSize[1])/Math.min(this.mapSize[0],this.mapSize[1])),this.setZoom(this.zoom)},getMapWidth:function(){return this.mapSize[0]},getMapHeight:function(){return this.mapSize[1]},getZoomedMapWidth:function(){return this.mapSize[0]*this.zoom},getZoomedMapHeight:function(){return this.mapSize[1]*this.zoom},getViewWidth:function(){return this.viewSize[0]},getViewHeight:function(){return this.viewSize[1]},getUnzoomedViewWidth:function(){return this.viewSize[0]/this.zoom},getUnzoomedViewHeight:function(){return this.viewSize[1]/this.zoom},transformPoint:function(t){var e=vec2.add(vec2.create(),this.getZoomedMapPosition(),vec2.scale(vec2.create(),t,this.zoom));return 0!==this.options.map2DRotation?this.rotatePointAroundCenter(e,vec2.fromValues(this.getViewWidth()/2,this.getViewHeight()/2),this.options.map2DRotation):e},inverseTransformPoint:function(t){if(0!==this.options.map2DRotation){var e=vec2.fromValues(this.getViewWidth()/(2*this.getViewScale()),this.getViewHeight()/(2*this.getViewScale()));t=this.rotatePointAroundCenter(t,e,-this.options.map2DRotation)}return vec2.scale(t,t,this.viewScale),vec2.add(t,t,this.getZoomedPosition()),vec2.scale(t,t,1/this.zoom),t},getDrawingArea:function(){this.viewSize;return vec2.add(vec2.create(),this.viewSize,this.getZoomedPosition())},rotatePoint:function(t,e){var i=t[0]*Math.cos(e)-t[1]*Math.sin(e),n=t[1]*Math.cos(e)+t[0]*Math.sin(e);return vec2.fromValues(i,n)},rotatePointAroundCenter:function(t,e,i){return i=i*Math.PI/180,vec2.fromValues(Math.cos(i)*(t[0]-e[0])-Math.sin(i)*(t[1]-e[1])+e[0],Math.sin(i)*(t[0]-e[0])+Math.cos(i)*(t[1]-e[1])+e[1])}}),Path2D=Class.extend({init:function(){this.nodes=[]},isEmpty:function(){return 0===this.nodes.length},getBounds:function(t){var e={min:vec2.create(),max:vec2.create(),center:vec2.create(),size:vec2.create()};if(this.nodes.length>0){e.min[0]=this.nodes[0].position2d[0],e.min[1]=this.nodes[0].position2d[1],e.max[0]=this.nodes[0].position2d[0],e.max[1]=this.nodes[0].position2d[1];for(var i=1;i<this.nodes.length;i++){var n=this.nodes[i].position2d[0],o=this.nodes[i].position2d[1];n<e.min[0]&&(e.min[0]=n),o<e.min[1]&&(e.min[1]=o),n>e.max[0]&&(e.max[0]=n),o>e.max[1]&&(e.max[1]=o)}}return t&&"function"==typeof t&&(e.min=t(e.min),e.max=t(e.max)),e.size[0]=e.max[0]-e.min[0],e.size[1]=e.max[1]-e.min[1],e.center[0]=e.min[0]+e.size[0]/2,e.center[1]=e.min[1]+e.size[1]/2,e},getDistance:function(){var t=0;if(0==this.nodes.length)return t;for(var e=this.nodes[0],i=1,n=this.nodes.length;i<n;i++)t+=vec2.dist(e.position2d,this.nodes[i].position2d),e=this.nodes[i];return t}}),PathFinder2D=Class.extend({init:function(t){this.nodes=t,this.Infinity=Infinity,this.reset()},reset:function(){this.dist={},this.previous={},this.Q=[],this.searched={}},getNodeWithSmallestDistance:function(){for(var t=1/0,e=0,i=1;i<this.Q.length;i++)this.dist[this.Q[i]]<t&&(t=this.dist[this.Q[i]],e=i);return e},isSearched:function(t){return t in this.searched},decreaseKey:function(t){for(var e=0;e<this.Q.length&&this.Q[e]!=t;e++);for(var i=e-1;i>0&&this.dist[this.Q[e]]<this.dist[this.Q[i]];i--){var n=this.Q[i];this.Q[i]=this.Q[e],this.Q[e]=n,e=i}},distanceBetween:function(t,e){return vec3.len(vec3.fromValues(e.position[0]-t.position[0],e.position[1]-t.position[1],e.position[2]-t.position[2]))},find:function(t,e){if(this.reset(),!(t in this.nodes&&e in this.nodes))return!1;for(var i in this.nodes)this.dist[i]=this.Infinity,this.previous[i]=null,this.Q.push(i);for(this.dist[t]=0;this.Q.length>0;){var n=this.getNodeWithSmallestDistance(),o=this.Q[n];if(this.dist[o]==this.Infinity)break;if(this.Q.splice(n,1),this.searched[o]=!0,o==e){var s=new Path2D;for(o=e;null!==this.previous[o];)s.nodes.push(this.nodes[o]),o=this.previous[o];return s.nodes.push(this.nodes[t]),s.nodes.reverse(),s}for(i=0;i<this.nodes[o].neighbours.length;i++){var r=this.nodes[o].neighbours[i];if(!this.isSearched(r.id)){var a=this.dist[o]+this.distanceBetween(this.nodes[o],r)+r.weight;a<this.dist[r.id]&&(this.dist[r.id]=a,this.previous[r.id]=o,this.decreaseKey(r.id))}}}return!1}});